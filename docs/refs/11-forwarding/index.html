<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Messages Forwarding - INScore Documentation</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="/css/inscore.css" rel="stylesheet">
        <link href="/css/pubs.css" rel="stylesheet">
        <link href="/BNF/railroad-diagrams.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/inscore.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">INScore Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Messages</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../1-introduction/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../2-genformat/" class="dropdown-item">Format of a message</a>
</li>
            
<li>
    <a href="../3-common/" class="dropdown-item">Common Messages</a>
</li>
            
<li>
    <a href="../4-time/" class="dropdown-item">Time Messages</a>
</li>
            
<li>
    <a href="../5-miscmsgs/" class="dropdown-item">Miscellaneous</a>
</li>
            
<li>
    <a href="../6-setsect/" class="dropdown-item">The set Message</a>
</li>
            
<li>
    <a href="../7-getsect/" class="dropdown-item">The get Message</a>
</li>
            
<li>
    <a href="../8-specificMsg/" class="dropdown-item">Specific Messages</a>
</li>
            
<li>
    <a href="../9-ITL/" class="dropdown-item">Application Messages</a>
</li>
            
<li>
    <a href="../10-scene/" class="dropdown-item">Scene Messages</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Messages Forwarding</a>
</li>
            
<li>
    <a href="../12-layers/" class="dropdown-item">Layers</a>
</li>
            
<li>
    <a href="../13-mapping/" class="dropdown-item">Mapping</a>
</li>
            
<li>
    <a href="../14-syncmsg/" class="dropdown-item">Synchronization</a>
</li>
            
<li>
    <a href="../15-graphsig/" class="dropdown-item">Graphic signals</a>
</li>
            
<li>
    <a href="../16-sensors/" class="dropdown-item">Sensors</a>
</li>
            
<li>
    <a href="../17-interaction/" class="dropdown-item">Events</a>
</li>
            
<li>
    <a href="../18-scoreExpr/" class="dropdown-item">Score Expressions</a>
</li>
            
<li>
    <a href="../19-plugins/" class="dropdown-item">Plugins</a>
</li>
            
<li>
    <a href="../20-changes/" class="dropdown-item">Changes list</a>
</li>
            
<li>
    <a href="../" class="dropdown-item">Index</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Scripting language</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../lang/1-scripting/" class="dropdown-item">Language</a>
</li>
            
<li>
    <a href="../../lang/2-mathExpr/" class="dropdown-item">Math. expressions</a>
</li>
            
<li>
    <a href="../../lang/3-appendices/" class="dropdown-item">Grammar</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">INScore Web</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../web/1-introduction/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../web/2-mainDiffs/" class="dropdown-item">Global changes</a>
</li>
            
<li>
    <a href="../../web/3-unsupported/" class="dropdown-item">Unsupported messages</a>
</li>
            
<li>
    <a href="../../web/4-behavior/" class="dropdown-item">Behavioral changes</a>
</li>
            
<li>
    <a href="../../web/5-newMessages/" class="dropdown-item">Specific messages</a>
</li>
            
<li>
    <a href="../../web/6-MIDI/" class="dropdown-item">MIDI support</a>
</li>
            
<li>
    <a href="../../web/7-audioObjects/" class="dropdown-item">Audio objects</a>
</li>
            
<li>
    <a href="../../web/8-communication/" class="dropdown-item">Communication</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Documents <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="http://berio.grame.fr/MusicNotation/Introduction-to-INScore/" class="dropdown-item">Tutorial</a>
</li>
                                    
<li>
    <a href="../../rsrc/INScoreMessages.pdf" class="dropdown-item">Messages reference</a>
</li>
                                    
<li>
    <a href="../../rsrc/INScoreLang.pdf" class="dropdown-item">Language reference</a>
</li>
                                    
<li>
    <a href="../../rsrc/INScoreWeb.pdf" class="dropdown-item">Web reference</a>
</li>
                                    
<li>
    <a href="../../papers/" class="dropdown-item">Papers</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="https://github.com/grame-cncm/inscore/releases" class="dropdown-item">INScore</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../10-scene/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../12-layers/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#messages-forwarding" class="nav-link">Messages forwarding</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#remote-hosts-list" class="nav-link">Remote hosts list</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ssl-support" class="nav-link">SSL support</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#filters" class="nav-link">Filters</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#specific-queries" class="nav-link">Specific queries</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<script src='/BNF/railroad-diagrams.js'></script>

<h1 id="messages-forwarding">Messages forwarding</h1>
<p><a name="Forwarding"></a></p>
<p>The messages handled by the application or by a scene can be forwarded to arbitrary remote hosts. A filtering mecanism can be used to have a fine control of forwarded messages.</p>
<h2 id="remote-hosts-list">Remote hosts list</h2>
<p><a name="RemoteHosts"></a></p>
<p>Remote hosts lists can be set using the <span class="OSC">forward</span> message at scene or application level. Hosts lists of the application and of each scene are independent.
At scene level, only messages handle by the scene are forwarded (ie message for the scene itself or for one of his children object).
The <span class="OSC">forward</span> message itself can't be forwarded. 
A message from a host cannot be forwarded to him to avoid direct loop.</p>
<p><a name="11-Forwarding-forward"></a></p>
<div class="rail">
<span class="railtitle">ITLMsgForward</span>
<br /><script>
ComplexDiagram(
    Sequence ('forward', Choice (0, Comment ('1'), Sequence (Comment ('2'), OneOrMore (NonTerminal('ForwardDest')))))
).addTo()

</script>
</div>

<ul>
<li>1) removes the set of forward destinations,</li>
<li>2) set or extends the list of remote hosts for forwarding. </li>
</ul>
<div class="rail">
<span class="railtitle">ForwardDest</span>
<br /><script>
ComplexDiagram(
    OneOrMore (Sequence (Choice (0, Sequence (Comment ('1'), NonTerminal('hostname')), Sequence (Comment ('2'), 'osc://', NonTerminal('hostname')), Sequence (Comment ('3'), 'http://', NonTerminal('hostname')), Sequence (Comment ('4'), 'https://', NonTerminal('hostname')), Sequence (Comment ('5'), 'ws://', NonTerminal('hostname'))), Optional  ( Sequence (':', NonTerminal('portnum')))))
).addTo()

</script>
</div>

<p>The forwarding mechanism can use different protocols, expressed by the destination in the form of an url, optionally followed by a port number separated by a semi-colon. By default, when no port number is specified, the default application listening port number is used (7000).</p>
<ul>
<li>1) obsolete form preserved for compatibility: it's equivalent to 2). </li>
<li>2) messages are forwarded using the OSC protocol.</li>
<li>3) messages are forwarded in textual form using the HTTP protocol.</li>
<li>3) messages are forwarded in textual form using the HTTPS protocol. See section <a href="../11-Forwarding#SSL">SSL</a> about additional requirements for encrypted connections.</li>
<li>5) messages are forwarded in textual form using WebSockets.</li>
</ul>
<p><span class="example">Example</span>
Forwards messages at application level to <span class="OSC">host1.adomain.org</span> using OSC and the default application listening port number (7000)
and to <span class="OSC">host2.adomain.org</span> using HTTP on port number 5100 .</p>
<pre><code class="language-inscore">/ITL forward osc://host1.adomain.org http://host2.adomain.org:5100;
</code></pre>
<h2 id="ssl-support">SSL support</h2>
<p><a name="SSL"></a></p>
<p>When you use <span class="OSC">https</span> as a communication protocol, a digital certificate and an encryption key are required to establish connections between INScore and the client stations. The certificate must be signed by a trusted certificate authority. Short term certificates are freely available on the internet. </p>
<p>Before issuing a <span class="OSC">forward</span> message on an encrypted communication channel, the key and certificate must be loaded by INScore. For this purpose, a set of messages is provided by the application ssl node  <span class="OSC">/ITL/ssl</span>:</p>
<p><a name="11-Forwarding-key"></a>
<a name="11-Forwarding-cert"></a>
<a name="11-Forwarding-cacert"></a></p>
<div class="rail">
<span class="railtitle">SslSetup</span>
<br /><script>
ComplexDiagram(
    Sequence (Choice (0, 'key', 'cert', 'cacert'), NonTerminal('file'))
).addTo()

</script>
</div>

<ul>
<li><span class="OSC">key</span> load 'file' as private key </li>
<li><span class="OSC">cert</span> load 'file' as digital certificate</li>
<li><span class="OSC">cacert</span> load 'file' as intermediate certificate used as certificate authority </li>
</ul>
<p><strong>file</strong> is a path to a file that can be absolute or relative. 
Resolution of relative paths differs from the approach used with <span class="OSC">rootPath</span>: a path expressed as relative will always refer to the <span class="OSC">.ssh</span> folder located at the root of the user directory ($HOME).</p>
<h2 id="filters">Filters</h2>
<p><a name="ITLFilteringForward"></a></p>
<p>The messages forwarded to arbitrary remote hosts using the <span class="OSC">forward</span> message can be filtered to send only wanted messages. The static <span class="OSC">filter</span> node is use manage the filter. A static <span class="OSC">filter</span> node is created for each scene and one at application level. The filter can be construct with OSC address and messages. </p>
<p><a name="11-Forwarding-accept"></a>
<a name="11-Forwarding-reject"></a></p>
<div class="rail">
<span class="railtitle">ITLFilteringForward</span>
<br /><script>
ComplexDiagram(
    Choice (0, Sequence (Comment ('1'), Sequence ('accept', Optional  ( OneOrMore (NonTerminal('item'))))), Sequence (Comment ('2'), Sequence ('reject', Optional  ( OneOrMore (NonTerminal('item'))))))
).addTo()

</script>
</div>

<ul>
<li>1) Replace the current accepted list by the new list or by an empty list. Item in accepted list are not filtered by the reject item list.</li>
<li>2) Replace the current accepted list by the new list or by an empty list. Item in reject list are filtered if they not match the accept list.</li>
</ul>
<p>When a new message is incoming, if they match to an accepted item, filter is not apply.</p>
<p><span class="example">Example</span>
Filter at application level :</p>
<pre><code class="language-inscore">/ITL/filter reject /ITL/scene/line* /ITL/scene/rect; 
/ITL/filter accept /ITL/scene/line2 scale arrows;
</code></pre>
<p>Messages with address starting with <span class="OSC">/ITL/scene/line</span> or addressed to <span class="OSC">/ITL/scene/rect</span> are filtered only if message address is not <span class="OSC">/ITL/scene/line2</span> or if the content is not <span class="OSC">scale</span> or <span class="OSC">arrows</span>.</p>
<p>Filter at scene level :</p>
<pre><code class="language-inscore">/ITL/scene1/filter reject fontWeight /ITL/scene1/rect;
</code></pre>
<p>The <span class="OSC">fontWeight</span> message and message for <span class="OSC">/ITL/scene1/rect</span> are rejected.</p>
<p><span class="note">Note: </span>
INScore is message based in a consistent way: all actions are triggered by messages (including, for example, quitting the application). Some messages are generated internally. This is the case of <span class="OSC">ddate</span>: an object sends <span class="OSC">ddate</span> messages to itself when its tempo is not zero. It is therefore recommended to filter <span class="OSC">ddate</span>: in the absence of a filter, a recipient who receives a <span class="OSC">tempo</span> message will generate these messages internally, but will also receive those that have been forwarded. Its actual tempo will then be twice the one set.</p>
<h2 id="specific-queries">Specific queries</h2>
<p><a name="ITLForwardQueries"></a></p>
<p>When using connection oriented protocols with the <span class="OSC">forward</span> message (<span class="OSC">http</span>, <span class="OSC">https</span>, <span class="OSC">ws</span>), you can query the number of connected clients:</p>
<p><a name="11-Forwarding-get"></a></p>
<div class="rail">
<span class="railtitle">ITLClientsQuery</span>
<br /><script>
ComplexDiagram(
    Sequence ('get', 'clients')
).addTo()

</script>
</div>
<p>The message must be addressed at the application level (<span class="OSC">/ITL</span>). 
The answer is detailed for each type of connection-oriented protocol in service.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p><a href="https://inscore.grame.fr">INscore projects</a> Copyright &copy; 2019-2021 <a href="http://www.grame.fr">Grame-CNCM</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="/js/inscore.js" defer></script>
        <script src="/js/pubs.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

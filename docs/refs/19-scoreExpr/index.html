<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Score Expressions - INScore Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="/css/inscore.css" rel="stylesheet">
        <link href="/BNF/railroad-diagrams.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">INScore Documentation</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="http://berio.grame.fr/MusicNotation/Introduction-to-INScore/">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../1-genformat/">Format of a message</a>
</li>
                                    
<li >
    <a href="../2-common/">Common Messages</a>
</li>
                                    
<li >
    <a href="../3-time/">Time Messages</a>
</li>
                                    
<li >
    <a href="../4-miscmsgs/">Miscellaneous</a>
</li>
                                    
<li >
    <a href="../5-setsect/">The set Message</a>
</li>
                                    
<li >
    <a href="../6-getsect/">The get Message</a>
</li>
                                    
<li >
    <a href="../7-specificMsg/">Specific Messages</a>
</li>
                                    
<li >
    <a href="../8-ITL/">Application Messages</a>
</li>
                                    
<li >
    <a href="../9-scene/">Scene Messages</a>
</li>
                                    
<li >
    <a href="../10-forwarding/">Messages Forwarding</a>
</li>
                                    
<li >
    <a href="../11-layers/">Layers</a>
</li>
                                    
<li >
    <a href="../12-mapping/">Mapping</a>
</li>
                                    
<li >
    <a href="../13-syncmsg/">Synchronization</a>
</li>
                                    
<li >
    <a href="../14-graphsig/">Graphic signals</a>
</li>
                                    
<li >
    <a href="../15-sensors/">Sensors</a>
</li>
                                    
<li >
    <a href="../16-interaction/">Interaction</a>
</li>
                                    
<li >
    <a href="../17-scripting/">Scripting</a>
</li>
                                    
<li >
    <a href="../18-mathExpr/">Math Expressions</a>
</li>
                                    
<li class="active">
    <a href="./">Score Expressions</a>
</li>
                                    
<li >
    <a href="../20-plugins/">Plugins</a>
</li>
                                    
<li >
    <a href="../21-appendices/">Grammar definition</a>
</li>
                                    
<li >
    <a href="../22-changes/">Changes list</a>
</li>
                                    
<li >
    <a href="../">Index</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../rsrc/INScoreLang.pdf">Pdf documentation</a>
</li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../about/">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../18-mathExpr/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../20-plugins/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#score-expressions">Score expressions</a></li>
            <li><a href="#general-syntax">General Syntax</a></li>
            <li><a href="#score-operators">Score Operators</a></li>
            <li><a href="#score-arguments">Score Arguments</a></li>
            <li><a href="#expr-commands">'expr' commands</a></li>
            <li><a href="#newdata-event">newData event</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<script src='/BNF/railroad-diagrams.js'></script>

<h1 id="score-expressions">Score expressions</h1>
<p><a name="scoreExpr"></a></p>
<p><strong>Score expressions</strong> allows to defines score objects (<span class="OSC">gmn</span> or <span class="OSC">pianoroll</span>) by dynamically combine various resources using a formal expression. To define such object one should use the basic <span class="OSC">set</span> messages using a score expressions as arguments:</p>
<p><span class="example">Example</span>
The following example defines a <span class="OSC">gmn</span> and a <span class="OSC">pianoroll</span> object using score expressions, the meaning of the expression is explained further.</p>
<pre><code>/ITL/scene/score set gmn expr(seq [a] [b]); 
/ITL/scene/pianoroll set pianoroll expr(score);
</code></pre>

<h2 id="general-syntax">General Syntax</h2>
<p><a name="exprSyntax"></a></p>
<p>A score expression  always starts with <span class="OSC">expr(</span> and ends with <span class="OSC">)</span>, then 
2 syntaxes are handled:</p>
<div class="rail">
<span class="railtitle">EvaluableExpression</span>
<br /><script>
ComplexDiagram(
    Sequence ('expr', '(', Choice (0, Sequence (Comment ('1'), NonTerminal('operator'), NonTerminal('score'), NonTerminal('score')), Sequence (Comment ('2'), NonTerminal('score'))), ')')
).addTo()

</script>
</div>

<ul>
<li><strong>1</strong>: Define an expression as an operation combining two scores. <span class="OSC">operator</span> is the name of the operation used to combine them (see Section~<a href="../19-scoreExpr#operators">operators</a> for operators list), and <span class="OSC">score</span> are the arguments passed to  the operator (see Section~<a href="../19-scoreExpr#arguments">arguments</a> for arguments specification).</li>
<li><strong>2</strong>: Define on expression using a single score. This syntax is useful when defining an object as a dynamic copy of an other existing object or file.</li>
</ul>
<p>Each of these tokens can, of course, be separated by spaces, tabulations or carriage returns (allowing multiline expression definition).</p>
<p>When defining an object using a score expressions, INScore will parse it, construct an internal representation and finally evaluate it, reducing the formal expressions to a valid GMN string.</p>
<p><span class="example">Example</span> 
Creating a guido object by sequencing two guido string</p>
<pre><code>/ITL/scene/score set gmn expr( seq &quot;[c d e]&quot; &quot;[f g h]&quot;);
</code></pre>

<p>is equivalent to</p>
<pre><code>/ITL/scene/score set gmn &quot;[c d e f g h]&quot;;
</code></pre>

<h2 id="score-operators">Score Operators</h2>
<p><a name="operators"></a></p>
<p>All the score operators of INScore make use of guido operators implemented in the GuidoAR library.</p>
<table>
<thead>
<tr>
<th align="right">operation</th>
<th>arguments</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">seq</td>
<td>$s1\ s2$</td>
<td>puts the scores <script type="math/tex">s1</script> and <script type="math/tex">s2</script> in sequence</td>
</tr>
<tr>
<td align="right">par</td>
<td>$s1\ s2$</td>
<td>puts the scores <script type="math/tex">s1</script> and <script type="math/tex">s2</script> in parallel</td>
</tr>
<tr>
<td align="right">rpar</td>
<td>$s1\ s2$</td>
<td>puts the scores <script type="math/tex">s1</script> and <script type="math/tex">s2</script> in parallel, right aligned</td>
</tr>
<tr>
<td align="right">top</td>
<td>$s1\ s2$</td>
<td>takes the <script type="math/tex">n</script> first voices of <script type="math/tex">s1</script> where <script type="math/tex">n</script> is <script type="math/tex">s2</script> voices count</td>
</tr>
<tr>
<td align="right">bottom</td>
<td>$s1\ s2$</td>
<td>cut the <script type="math/tex">n</script> first voices of <script type="math/tex">s1</script> where <script type="math/tex">n</script> is <script type="math/tex">s2</script> voices count</td>
</tr>
<tr>
<td align="right">head</td>
<td>$s1\ s2$</td>
<td>takes the head of <script type="math/tex">s1</script> up to <script type="math/tex">s2</script> duration</td>
</tr>
<tr>
<td align="right">evhead</td>
<td>$s1\ s2$</td>
<td>takes the <script type="math/tex">n</script> first events of <script type="math/tex">s1</script> where <script type="math/tex">n</script> is the event's count of <script type="math/tex">s2</script>
</td>
</tr>
<tr>
<td align="right">tail</td>
<td>$s1\ s2$</td>
<td>cut the beginning of <script type="math/tex">s1</script> up to the duration of <script type="math/tex">s2</script>
</td>
</tr>
<tr>
<td align="right">evtail</td>
<td>$s1\ s2$</td>
<td>cut the <script type="math/tex">n</script> first events of <script type="math/tex">s1</script> where <script type="math/tex">n</script> is the event's count of <script type="math/tex">s2</script>
</td>
</tr>
<tr>
<td align="right">transpose</td>
<td>$s1\ s2$</td>
<td>transposes <script type="math/tex">s1</script> so its first note of its first voice match <script type="math/tex">s2</script> one</td>
</tr>
<tr>
<td align="right">duration</td>
<td>$s1\ s2$</td>
<td>stretches <script type="math/tex">s1</script> to the duration of <script type="math/tex">s2</script>
</td>
</tr>
<tr>
<td align="right"></td>
<td></td>
<td>if not used carefully, this operator can output impossible to display rhythm</td>
</tr>
<tr>
<td align="right">pitch</td>
<td>$s1\ s2$</td>
<td>applies the pitches of <script type="math/tex">s1</script> to <script type="math/tex">s2</script> in a loop</td>
</tr>
<tr>
<td align="right">rhythm</td>
<td>$s1\ s2$</td>
<td>applies the rhythm of <script type="math/tex">s1</script> to <script type="math/tex">s2</script> in a loop</td>
</tr>
<tr>
<td align="right"></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><span class='caption'></span></p>
<h2 id="score-arguments">Score Arguments</h2>
<p><a name="arguments"></a></p>
<p>The syntax for arguments is quite permissive and various resources can be used as arguments for score expressions. In any case, when evaluating the expression, all the arguments will be reduce to GMN string so they can then be processed by the operators.</p>
<div class="rail">
<span class="railtitle">Argument</span>
<br /><script>
ComplexDiagram(
    Choice (0, NonTerminal('GmnCode'), Sequence (Optional  ( Choice (0, '&', '\(\sim\)')), Choice (0, NonTerminal('filepath'), NonTerminal('ScoreObject'))), NonTerminal('EvaluableExpression'))
).addTo()

</script>
</div>

<h3 id="arguments-specification">Arguments specification</h3>
<p>\subsubsection{Arguments specification}
<a name="argsSpec"></a></p>
<ul>
<li><span class="OSC">GmnCode</span> are not evaluated, passed as they are to operators. Both GMN and MusicXML string are supported.</li>
<li><span class="OSC">filepath</span>: on evaluation INScore read all the content of the file. Again, both GMN and MusicXML are supported. <span class="OSC">filepath</span> handle absolute or relative path (from the scene rootPath) as well as url.</li>
<li><span class="OSC">ScoreObject</span>: Gmn code can be retreive from existing score objects (<span class="OSC">gmn</span> or <span class="OSC">pianoroll</span>) simply refering to them using their identifier (using absolute or relative path).</li>
<li><span class="OSC">EvaluableExpression</span>: an expression can also be used as an argument, thus simple operator can be combined together to create more complex ones. In that case the <span class="OSC">expr</span> token can be omitted: parenthesis are sufficient.</li>
</ul>
<h3 id="arguments-prefix">Arguments prefix</h3>
<p>\subsubsection{Arguments prefix}
<a name="argsPrefix"></a></p>
<ul>
<li>
<p><span class="OSC">&amp;</span>: When triggering the reevaluation of an expression (see Section <a href="../19-scoreExpr#exprCmd">exprCmd</a>) only the arguments prefixed with <span class="OSC">&amp;</span> are updated.</p>
</li>
<li>
<p><span class="OSC">~</span>: before the first evaluation of a score expression, any <span class="OSC">ScoreObjects</span> prefixed with a <span class="OSC">~</span> shall be replaced by their own expression. In other words, score expressions containing <span class="OSC">~</span> arguments will be expended with existing score expressions. This mechanism allows to compose not only scores and score expressions together.</p>
</li>
</ul>
<p><span class="example">Example</span>
Defining <span class="OSC">/ITL/scene/score</span> as a copy of <span class="OSC">/ITL/scene/simpleScore</span> duplicated 4 times.</p>
<pre><code>/ITL/scene/simpleScore set gmn &quot;[e \{c,g\} |]&quot;;

/ITL/scene/score set gmn expr( &amp;simpleScore );
/ITL/scene/score set gmn expr( seq ~ score ~ score);
/ITL/scene/score set gmn expr( par ~ score ~ score);
</code></pre>

<p><span class="OSC">/ITL/scene/score</span> should look like:
<img alt="argsPrefix" src="../imgs/seqparEnhanced.png" />    </p>
<p>Querying for the expanded expression of <span class="OSC">/ITL/scene/score</span> (see Section~<a href="../19-scoreExpr#exprCmd">exprCmd</a>) should return:</p>
<pre><code>/ITL/scene/score expr
  expr( par
       ( seq
          &amp;simpleScore
          &amp;simpleScore
       )
       ( seq
          &amp;simpleScore
          &amp;simpleScore
       )
  )
</code></pre>

<p><span class="note">Note: on arguments quoting</span> 
Arguments using special characters (space, tabulation, parenthesis, braces...), should be simple or double quoted, otherwise quotes can be omitted.</p>
<h2 id="expr-commands">'expr' commands</h2>
<p><a name="exprCmd"></a></p>
<p>ITLObject defined using an evaluable expression gain access to these specific commands:</p>
<ul>
<li><span class="OSC">get expr</span>: return the expression used to define the object (before the expansion of <span class="OSC">~</span> arguments).</li>
<li>
<p><span class="OSC">get exprTree</span>: return the expanded expression</p>
</li>
<li>
<p><span class="OSC">expr reeval</span>: re-evaluate the expression, updating only the value of arguments prefixed with <span class="OSC">&amp;</span>.</p>
</li>
<li><span class="OSC">expr reset</span>: re-evaluate the expression, updating the value of all arguments.</li>
<li><span class="OSC">expr renew</span>: reapply the definition of the object (similar to send its <span class="OSC">set</span> message again)</li>
</ul>
<p>Applied to an object which wasn't defined by an evaluable expression, all this commands will cause a bad argument error.</p>
<p>The <span class="OSC">renew</span> command reset the internal state of the evaluated variable, forcing the re-evaluation and update of every arguments in the expression. Be aware that the track of copy evaluated arguments is lost after the first evaluation, thus renewing an expression defined using copy evaluated arguments won't update these arguments to their targeted ITLObject expression. Though, static arguments added by the copy shall be renewed.</p>
<h2 id="newdata-event">newData event</h2>
<p><a name="exprNewData"></a></p>
<p><span class="OSC">newData</span> is triggered by any object when its value change (generally because of a <span class="OSC">set</span> message). Neither trying to set an object to its actual value without changing its type, nor re-evaluating an object to its actual value will trigger newData.</p>
<p>Of course, the <span class="OSC">newData</span> event can be used together with <span class="OSC">reeval</span> to automatically update an object when the value of an other changes.</p>
<p><span class="example">Example</span>
Creating a copy of <span class="OSC">score</span>, and automatise its update when <span class="OSC">score</span> is changed</p>
<pre><code>/ITL/scene/score set gmn &quot;[c e]&quot;;
/ITL/scene/copy set gmn expr(&amp;score);
/ITL/scene/score watch newData (/ITL/scene/copy expr reeval);
</code></pre>

<p>To avoid infinite loop when using recursion, <span class="OSC">newData</span> event is delayed of one event loop, meaning that, in the previous example, during the event loop that follow <span class="OSC">score</span>'s modification, <span class="OSC">score</span> and <span class="OSC">copy</span> are different (<span class="OSC">copy</span> has not been updated yet...).</p>
<p><span class="note">Note:</span>
Because newData event is delayed, if <span class="OSC">score</span> experiences multiple modifications during the same event loop (because multiple <span class="OSC">set</span> messages have been sent together), only his final value will be accessible when newData will be actually triggered, however the event will be sent as many times as <span class="OSC">score</span> have been modified.</p>
<p><span class="note">Note: when automatizing update</span>
For the reasons raised in the previous note, one should be very careful to delayed update when automatise <span class="OSC">reeval</span> with <span class="OSC">newData</span>. Indeed, in some extreme case, executing a script one line after an other won't have the same result as executing the all script at once!!</p>
<p><span class="example">Example</span>
Creating a "score buffer", storing every state adopted by <span class="OSC">score</span></p>
<pre><code>/ITL/scene/score set gmn &quot;[c]&quot;;

/ITL/scene/buffer set gmn &quot;[]&quot;;
/ITL/scene/buffer set gmn expr(seq &amp;buffer (seq &quot;[|]&quot; &amp;score));
/ITL/scene/score watch newData (/ITL/scene/buffer expr reeval);

/ITL/scene/score set gmn &quot;[e]&quot;;
/ITL/scene/score set gmn &quot;[g]&quot;;
/ITL/scene/score set gmn &quot;[\{c,e,g\}]&quot;;
</code></pre>

<p>Won't have the same result if run line by line, or the all script as once:
Line by line:
<img alt="exprNewData" src="../imgs/autoSingleLine.png" />    </p>
<p>All script at once:
<img alt="exprNewData" src="../imgs/autoAllScript.png" />    </p>
<p>To avoid such undeterministic behaviour, one should, in this case, manually trigger <span class="OSC">reeval</span> after each modification of <span class="OSC">score</span>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p><a href="https://inscore.grame.fr">INscore projects</a> Copyright &copy; 2019-2020 <a href="http://www.grame.fr">Grame-CNCM</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

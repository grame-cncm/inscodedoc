
\documentclass[a4paper,twoside]{report}
\usepackage{INScore}
\usepackage[T1]{fontenc}
\usepackage{ae,aecompl}
\usepackage{pslatex}
\usepackage{times}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{rail}
\usepackage{makeidx}
\usepackage{color}
\usepackage{hyperref}
\usepackage{comment}
\usepackage{multicol}
\usepackage{textcomp}


\definecolor{mycolor}{rgb}{0.384,0.0,0.145}
\hypersetup{
	colorlinks=true,
	linkcolor= mycolor
}


\setlength\parskip{\medskipamount}

\makeatletter
\railparam{\addtolength{\itemsep}{-3ex}}

%\newcommand{\toplevel}[1]	{\section{#1}}
%\newcommand{\sublevel}[1]	{\subsection{#1}}
%\newcommand{\subsublevel}[1]	{\subsubsection{#1}}

\newcommand{\toplevel}[1]	{\chapter{#1}}
\newcommand{\sublevel}[1]	{\section{#1}}
\newcommand{\subsublevel}[1]	{\subsection{#1}}

\newcommand{\fullref}[1]	{\ref{#1} p.\pageref{#1}}

\providecommand{\boldsymbol}[1]{\mbox{\boldmath $#1$}}
\newcommand{\OSC}[1]		{\texttt{#1}}
\newcommand{\values}[1]		{\texttt{#1}}
\newcommand{\oldexample}	{\hspace*{1cm}}
\newcommand{\example}		{\textbf{\hspace{-1.5cm}\textbf{\textsc{Example }}}}
\newcommand{\note}	[1]		{\vspace{2mm}\textbf{\hspace{-0.9cm}\textbf{\textsc{Note #1}}}}
\newcommand{\warning}[1]	{\vspace{2mm}\textbf{\hspace{-1.5cm}\textbf{\textsc{Warning #1}}}}

\renewcommand{\seealso}		{\textbf{See also: }}

\newcommand{\osctype}[1]	{\textbf{\texttt{{\small #1}}}}
\newcommand{\oscint}		{\osctype{int32}}
\newcommand{\oscfloat}		{\osctype{float32}}
\newcommand{\oscstring}		{\osctype{string}}
\newcommand{\rational}		{\osctype{rational}}
\newcommand{\lowTilde} 		{\texttildelow}
\newcommand{\icomment} 		{\#}

\let\olditemize\itemize
\let\oldenditemize\enditemize
\renewenvironment{itemize} 	{\olditemize \setlength{\itemsep}{1mm}}{\oldenditemize}


\setlength\parskip{2pt}
\setlength\railnamesep{-1mm}
\railterm{int32, float32, string}
\railalias{int32}{\oscint}
\railalias{float32}{\oscfloat}
\railalias{string}{\oscstring}


\definecolor{mygrey}{gray}{0.93}
\newcommand{\sample}	[1]			{\vspace{-2mm}\begin{center}\colorbox{mygrey}{
								\begin{minipage}[t]{0.9\columnwidth} 
								{\small \texttt{#1}}
								\end{minipage}}\end{center}}
\newcommand{\samplev}[1]			{\begin{center}\colorbox{mygrey}{
								\begin{minipage}[t]{\columnwidth} 
								{\small \texttt{#1}}
								\end{minipage}}\end{center}}
\newcommand{\sampleindent}	{ \hspace{0.5cm} }


\makeatother
\makeindex


\begin{document}

\title{INScore \\ OSC Messages Reference \\v.1.25}

\author{D. Fober\\ GRAME\\ Centre national de cr\'eation musicale\\
{\small <fober@grame.fr>} \\
%\vspace{2mm}
%ANR-08-CORD-010
}

\maketitle

\vspace*{17.5cm}
 
{\small INScore makes use of the following technologies:}
\begin{table}[h]
\begin{tabular}{ll}
{\small The GUIDOEngine}  					& {\small \url{http://guidolib.sf.net}} \\
{\small The IRCAM Gesture Follower} 		& {\small \url{http://imtr.ircam.fr/imtr/Gesture_Follower}} \\
{\small The GRAME Faust Compiler} 		& {\small \url{http://faust.grame.fr}} \\
{\small The Qt5 cross-platform application and UI framework} & {\small \url{https://www.qt.io/}}
\end{tabular}
\end{table}%

{\small INScore research and development has been funded by the French National Research Agency [ANR]\\ Interlude project [ANR- 08-CORD-010] and INEDIT project [ANR-12-CORD-0009].}
  

\pagestyle{empty}
\cleardoublepage
\tableofcontents

\vspace*{18.5cm}

\noindent\hrulefill\par
\vspace*{2mm}
\noindent\makebox[\textwidth][c]{%
    \begin{minipage}{1.\textwidth}
{\Large \textbf{Warning}}

\vspace*{5mm}
Throughout the documentation, all the sample code are given using scripting syntax i.e. that OSC messges are suffixed with a semi-colon ';'. This semi-colon is used as a message separator in INScore scripts and is not needed when sending messages over a network.
\end{minipage}}
\thispagestyle{empty}
\pagestyle{plain}

\newpage

\setcounter{page}{1}

%===============================
%:General format
\toplevel{General format}
\label{genformat}
An OSC message is made of an OSC address, followed by a message string, followed by zero to n parameters. The message string could be viewed as the method name of the object identified by the OSC address.
The OSC address could be string or a regular expression matching several objects.
\begin{rail}
OSCMessage : OSCAddress message (parameters |)
\end{rail}
\example
\sample{/ITL/scene/score x 0.5;}
sends the message \OSC{x} to the object which address is \OSC{/ITL/scene/score} with \OSC{0.5} as parameter.

The address is similar to a Unix path and supports regular expressions as defined by the OSC specification (see at \url{http://opensoundcontrol.org/}). This address scheme is extended to address any host and applications (see section \fullref{interaction}). Relative addresses have also been introduced for the scripting language (see section \fullref{scriptmsgs})

\note{} A valid legal OSC address always starts with \OSC{/ITL} that is the application address and that is also used as a discriminant for incoming messages.
\begin{rail}
OSCAddress : '/' (identifier | regexp) +
\end{rail}

Identifiers may include letters, hyphen, underscore and numbers apart at first position (see lexical definition section \fullref{lex}).
\railalias{startid}{[-\_a-zA-Z]}
\railalias{nextid}{[-\_a-zA-Z0-9]]}
\begin{rail}
identifier : startid (nextid +)
\end{rail}

Some specific nodes (like \emph{signals} - see section \ref{ssignal}) accept OSC messages without message string:
\begin{rail}
SigOSCMessage : OSCAddress parameters
\end{rail}

%===============================
\sublevel{Parameters}
\label{params}
Message parameters types are the OSC types \emph{int32}, \emph{float32} and \emph{OSC-string}. In the remainder of this document, they are used as terminal symbols, denoted by \oscint, \oscfloat\ and \oscstring. 

When used in a script file (see section \ref{scripting}), \oscstring\ should be single or double quoted when they include characters not allowed in identifiers (space, punctuation marks, etc.).
If an ambiguous double or single quote is part of the string, it must be escaped using a '\verb+\+'.

Parameters types policy is relaxed: the system makes its best to convert a parameter to the expected type, which depend on the message string. With an incorrect type and when no conversion is applied, an incorrect parameter message is issued.

%===============================
\sublevel{Address space}
\label{addrspace}
The OSC address space is made of static and dynamic nodes, hierarchically organized as in figure \ref{fig:addrspace}:

\begin{figure}[h]
	\centering \includegraphics[width=120mm]{imgs/address_space}
 \caption{The OSC address space. Nodes in italic/blue are dynamic nodes.}
 \label{fig:addrspace}
\end{figure}

OSC messages are accepted at any level of the hierarchy:
\begin{itemize}

\item \textbf{the application level} responds to messages for application management (udp ports management, loading files, query messages). \\

\item \textbf{the scene level} contains \emph{scores} that are associated to a window and respond to specific scene management messages. 
It includes a static node named \OSC{stats} that collects information about incoming messages, a static \OSC{log} node that control an embedded log window.


\item \textbf{the component level} contains the score components and 3 static nodes:
\begin{itemize}
\item a \emph{signal} node that may be viewed as a folder containing signals
\item a \emph{sync} node, in charge of the synchronization messages
\item a \emph{javascript} node, that may be adressed to run javascript code dynamically.
\end{itemize}

Each component includes a static node named \OSC{debug} that provides debugging information.
\item \textbf{the signals level} contains signals i.e. objects that accept data streams and that may be graphically rendered as a scene component (see Signals and Graphic signals section \fullref{graphsig}).

\end{itemize}

\note{} Since version 1.05, each component of a score may also be a container and thus, the hierarchy described above has a potential infinite depth level. Note also that a \OSC{sync} node is present at each level. 


%===============================
\sublevel{Aliases}
\label{alias}
An alias mechanism allows an arbitrary OSC address to be used in place of a real address. An \OSC{alias} message is provided to describe aliases: 

\index{Common messages!alias}

\begin{rail}
alias : OSCAddress 'alias' (([1] OSCAlias ( (message ('[n,m]' |))+ | ) ) | [2])
\end{rail}
\begin{itemize}
\item \textbf{[1]} sets \OSC{OSCAlias} as an alias of \OSC{OSCAddress}. The alias may be optionally followed by message strings which are then taken as implied messages. These messages can also be optionally followed by a scaling specification.
\item \textbf{[2]} removes \OSC{OSCAddress} aliases.
\end{itemize}

\note{} Regular expressions are not supported by the alias mechanism and could lead to unpredictable results.

\example
\sample{makes the address /ITL/scene/myobject available using /1/fader1\\
/ITL/scene/myobject alias '/1/fader1';\\
\\
the following input message:\\
/1/fader1 0.5;\\
will be translated into:\\
/ITL/scene/myobject 0.5;
}

\sample{create an alias with an implicit 'x' message\\
/ITL/scene/myobject alias '/1/fader1' x;\\
\\
the following input message:\\
/1/fader1 0.5;\\
will be translated into:\\
/ITL/scene/myobject x 0.5;
}

\subsublevel{Scaling}
\label{scaling}
In INScore, the parameter values are generally in the range [-1, 1]. However, some devices can generate messages with their own values range (e. g. accelerometers). An optional scaling string allows to convert any input range into the [-1, 1] range.

The general form of the scaling string is \OSC{[n,m]}, where $n$ and $m$ are 2 numbers describing the minimum and maximum input values. Any input value $v$ is then transformed into a value $v'$ such that:
\[
	v' = 2 (v-n)/(n-m) - 1
\]

\example
\sample{create an alias with an implicit 'x' message using a scaling specification\\
/ITL/scene/myobject alias '/1/fader1' x[0,100];\\
\\
the following input message:\\
/1/fader1 5;\\
will be translated into:\\
/ITL/scene/myobject x -0.9;
}


\subsublevel{Using more than one implicit message}
\label{implicitmsg}
You can you any arbitrary number of message strings in an \OSC{alias} message. In any case, an input message with the corresponding values is expected. For example, when the \OSC{alias} message has 3 messages strings, input messages are expected to have 3 associated values. These values are distributed in sequence with each message string, which also means that the input message is translated into 3 different messages.
 

\example
\sample{create an alias with implicit 'x' 'y' and 'angle' messages using scaling\\
/ITL/scene/myobject alias '/1/fader1' x[0,100] y[0,100] angle;\\
\\
the following input message:\\
/1/fader1 5 60 12;\\
will be translated into:\\
/ITL/scene/myobject x -0.9;\\
/ITL/scene/myobject y  0.2;\\
/ITL/scene/myobject angle 12;
}



%===============================
%:Common messages
\toplevel{Common messages}
\label{common}
Common messages are intended to control the graphic and the time space of the components of a scene.
They could be sent to any address with the form \OSC{/ITL/\textit{scene}} or \OSC{/ITL/\textit{scene}/\textit{identifier}} where \OSC{\textit{identifier}} is the unique identifier of a scene component.

\index{Common messages!show}
\index{Common messages!del}
\index{Common messages!lock}
\index{Common messages!export}
\index{Common messages!exportAll}
\index{Common messages!save}

\begin{rail}
commonMsg :  ('show' int32)
			| 'del'
			| ('lock' int32)
			| (('export' | 'exportAll') ((([1] filePath )+) | [2]))
			| ('save' (| 'message' +) filePath ( | '+'))
			| PositionMsg
			| ColorMsg
			| TimeMsg
			| WatchMsg
			| EventMsg
\end{rail}

\begin{itemize}
\item \OSC{show}: shows or hides the destination object. The parameter is interpreted as a boolean value. Default value is \values{1}. 
\item \OSC{del}: deletes the destination object. 

\item \OSC{lock}: if not null, cancel any \OSC{del} message sent to this object. The object will still be deleted if its ancestors receive a \OSC{del} message. The parameter is interpreted as a boolean value. Default value is \values{0}. 

\item \OSC{export} and \OSC{exportAll}: exports an object to an image file respectively without or with its childrens. If the exported object is a scene, childrens are always exported.\\
1) exports to the \OSC{filePath} name. The \OSC{filePath} can be relative or absolute. When the filename is not specified, exports to \OSC{path/\textit{identifier}.pdf}. The file extension is used to infer the export format. Supported extensions and formats are: \emph{pdf, bmp, gif, jpeg, png, pgm, ppm, tiff, xbm, xpm}. \\
2) exports to \OSC{rootPath/\textit{identifier}.pdf}.\\
When the destination file is not completely specified (second form or missing extension), there is an automatic numbering of output names when the destination file already exists. \\ 

\item \OSC{save}: recursively saves objects states to a file. When a \OSC{message} list is present, only the specified attributes are saved. The \OSC{filePath} can be relative or absolute. When relative, an absolute path is build using the current \OSC{rootPath} (see application or scene current paths  p.\pageref{applmgmt} and  p.\pageref{scene}). The optional \OSC{+} parameter indicates an append mode for the write operation. The message must be sent to the address \OSC{/ITL} to save the whole application state.\\
\textbf{Note}: when a list of attributes is specified, unknown attributes are silently ignored. \\
\textbf{Note}: the file extension for INScore files is \OSC{.inscore}. INScore files dropped on the application or on a window are interpreted as script files (see section \fullref{scripting}).

%\item \OSC{rename}: rename the destination object. Changes its OSC address. \textbf{Warning}: OSC pattern matching allows to give the same name to a whole collection of objects; in this case, there is no way to individually address an object when its name is shared with other objects.
\item 'PositionMsg' are absolute and relative position messages.
\item 'ColorMsg' are absolute and relative color control messages.
\item 'TimeMsg' are time management messages. They are described in section \fullref{time}.
\item 'WatchMsg' are described in section \fullref{interaction}.
\item 'EventMsg' are described in section \fullref{eventMsg}.
%\item 'clickSelectMsg' are provided to query objects relative positions.
\end{itemize}

\example \\
Export of a scene to a given file as jpeg at the current root path:
\sample{/ITL/scene export 'myexport.jpg';}
Saving a scene to \OSC{myScore.inscore} at the current root path, the second form saves only the \OSC{x}, \OSC{y} and \OSC{z} attributes, the third form uses the append mode:
\sample{/ITL/scene save 'myScore.inscore';\\
/ITL/scene save x y z 'thePositions.inscore'; \\
/ITL/scene save 'myScore.inscore' '+';
}
Hiding an object:
\sample{/ITL/scene/myObject show 0;}

%-------------------------------
%:    Positioning
\sublevel{Positioning}
\label{positionning}

\begin{rail}
PositionMsg : 		absPosMsg 
				|	relPosMsg 
				|	originMsg 
				| 	transformMsg
\end{rail}

Graphic position messages are absolute position or relative position messages. They can also control an object \emph{origin} and transformations like rotation around an axis.

\subsublevel{Absolute positioning}
\label{abspos}

\index{Position messages!absolute!x}
\index{Position messages!absolute!y}
\index{Position messages!absolute!z}
\index{Position messages!absolute!angle}
\index{Position messages!absolute!scale}
\index{Common messages!x}
\index{Common messages!y}
\index{Common messages!z}
\index{Common messages!angle}
\index{Common messages!scale}

\begin{rail}
absPosMsg :  
			('x' float32)
		| 	('y' float32)
		| 	('z' float32)
		| 	('angle' float32)
		| 	('scale' float32) 
\end{rail}

\begin{itemize}
\item \OSC{x y}: moves the \values{x} or \values{y} coordinate of a component. By default, components are centered on their \values{x}, \values{y} coordinates. The coordinates space range is \values{[-1,1]}. \\
For a \OSC{scene} component, -1 is the leftmost or topmost position, 1 is the rightmost or bottommost position. \values{[0,0]} represents the center of the \OSC{scene}. \\
For the \OSC{scene} itself, it moves the window in the screen space and the coordinate space is orthonormal, based on the screen lowest dimension (\emph{i.e.} with a 4:3 screen, \OSC{y=-1} and \OSC{y=1} are respectively the exact top and bottom of the screen, but neither \OSC{x=-1} nor \OSC{x=1} are the exact left and right of the screen). \\
Default coordinates are \values{[0,0]}.
\item \OSC{z}: sets the \values{z} order of a component. \values{z} order is actually relative to the \OSC{scene} components: objects of high \values{z} order will be drawn on top of components with a lower \values{z} order. Components sharing the same \values{z} order will be drawn in an undefined order, although the order will stay the same for as long as they live. \\
Default \values{z} order is 0.
\item \OSC{angle}: sets the \values{angle} value of a component, which is used to rotate it around its center. The angle is measured in clockwise degrees from the \values{x} axis.\\
Default angle value is 0.
\item \OSC{scale}: reduce/enlarge a component. Default scale is \values{1}.
\end{itemize}

\example \\
Moving and scaling an object:
\sample{/ITL/scene/myObject x -0.9; \\
/ITL/scene/myObject y 0.9; \\
/ITL/scene/myObject scale 2.0;
}

%-------------------------------
%:    Relative positioning
\subsublevel{Relative positioning}
\label{relpos}

\index{Position messages!relative!dx}
\index{Position messages!relative!dy}
\index{Position messages!relative!dz}
\index{Position messages!relative!dangle}
\index{Position messages!relative!drotatex}
\index{Position messages!relative!drotatey}
\index{Position messages!relative!drotatez}
\index{Position messages!relative!dscale}
\index{Common messages!dx}
\index{Common messages!dy}
\index{Common messages!dz}

\begin{rail}
relPosMsg :  
			('dx' float32)
		| 	('dy' float32)
		| 	('dz' float32)
		| 	('drotatex' float32)
		| 	('drotatey' float32)
		| 	('drotatez' float32)
		| 	('dangle' float32)
		| 	('dscale' float32) 
\end{rail}

\begin{itemize}
\item \OSC{dx}, \OSC{dy}, \OSC{dz} messages are similar to \OSC{x}, \OSC{y}, \OSC{z} but the parameters represent a displacement relative to the current target value.
\item \OSC{drotatex}, \OSC{drotatey}, \OSC{drotatez} are relative rotation messages. \OSC{dangle} is equivalent to \OSC{drotatez} and is maintained only for compatibility reasons.
\item \OSC{dscale} is similar to \OSC{scale} but the parameters represents a scale multiplying factor.
\end{itemize}

\example \\
Relative displacement of an object:
\sample{/ITL/scene/myObject dx 0.1;}

%-------------------------------
%:    Components origin
\subsublevel{Components origin}
\label{origin}

The origin of a component is the point \values{(xo, yo)} such that the \values{(x, y)} coordinates and the \values{(xo, yo)} point coincide graphically. For example, when the origin is the top left corner, the component top left corner is drawn  at the \values{(x, y)} coordinates.

\index{Position messages!relative!xorigin}
\index{Position messages!relative!yorigin}
\index{Position messages!relative!dxorigin}
\index{Position messages!relative!dyorigin}

\begin{rail}
originMsg :  
			('xorigin' float32)
		| 	('yorigin' float32)
		| 	('dxorigin' float32)
		| 	('dyorigin' float32)
\end{rail}

\begin{itemize}
\item \OSC{xorigin}, \OSC{yorigin} are relative to the component coordinates space i.e. \values{[-1,1]}, where -1 is the top or left border and 1 is the bottom or right border. The default origin is \values{[0,0]} i.e. the component is centered on its \values{(x,y)} coordinates.
\item \OSC{dxorigin}, \OSC{dyorigin} represents displacement of the current \OSC{xorigin} or \OSC{yorigin}.
\end{itemize}

\example \\
Setting an object graphic origin to the top left corner.
\sample{/ITL/scene/myObject xorigin -1. ;\\
/ITL/scene/myObject yorigin -1. ;
}

%-------------------------------
%:    Components transformations
\sublevel{Components transformations}
\label{transform}

A component tranformation specifies 2D transformations of its coordinate system. It includes shear and object rotation on x, y and z axis.

\index{Transform messages!rotate}
\index{Transform messages!shear}
\index{Transform messages!dshear}

\begin{rail}
transformMsg :
			(('rotatex' | 'rotatey' | 'rotatez' ) float32)
		|	(('drotatex' | 'drotatey' | 'drotatez') float32)
		| 	(('shear' | 'dshear') x y) 
\end{rail}

\begin{itemize}
\item \OSC{rotatex rotatey rotatez}: rotates the component around the corresponding axis. Parameter value expresses the rotation in degrees.
\item \OSC{drotatex drotatey drotatez}: relative rotations.
\item \OSC{shear} transforms the component in x and y dimensions. \OSC{x} and \OSC{y} are float values expressing the transformation value in the corresponding dimension. Values should be in the range ]-1, 1[.
\item \OSC{dshear} relative \OSC{shear} transformation.
\end{itemize}

\example \\
Rotating an object graphic on the \OSC{z} axis.
\sample{/ITL/scene/myObject rotatez 90. ;}

\note{} \OSC{angle} and \OSC{rotatez} are equivalent. \OSC{angle} has been introduced before the transformation messages and is maintained for compatibility reasons.

%-------------------------------
%:    Color messages
\sublevel{Color messages}
\label{colormsg}


\begin{rail}
ColorMsg : 	absColorMsg 
			|	relColorMsg 
\end{rail}

Color messages are absolute or relative color control messages. Color may be expressed in RGBA or HSBA.

\subsublevel{Absolute color messages}
\label{abscolor}

\index{Common messages!color}
\index{Common messages!color!name}
\index{Common messages!color!red}
\index{Common messages!color!blue}
\index{Common messages!color!green}
\index{Common messages!color!alpha}
\index{Common messages!color!hue}
\index{Common messages!color!saturation}
\index{Common messages!color!brightness}

\begin{rail}
absColorMsg :    color
			| hsb
			| 'red' colorvalue
			| 'green' colorvalue
			| 'blue' colorvalue
			| 'alpha' colorvalue
			| 'hue' colorvalue
			| 'saturation' colorvalue
			| 'brightness' colorvalue
\end{rail}

\OSC{red}, \OSC{green}, \OSC{blue}, \OSC{hue}, \OSC{saturation}, \OSC{brightness}, \OSC{alpha} messages address a specific part of a color using the RGB or HSB scheme.

\begin{rail}
colorvalue :    int32 | float32
\end{rail}

The value may be specified as integer or float. The data range is given in table \ref{colorrange}.
When the alpha component is not specified, the color is assumed to be opaque. 

\begin{table}[htbp]
\begin{center}
\begin{tabular}{|r|c|c|}
\hline
Component & integer range & float range \\
\hline
\OSC{red} [R] 		& [0,255] & [-1,1] \\
\OSC{green} [G] 	& [0,255] & [-1,1] \\
\OSC{blue} [B]		& [0,255] & [-1,1] \\
\OSC{alpha} [A] 	& [0,255] & [-1,1] \\
\OSC{hue} [H] 		& [0,360] & [-1,1] mapped to [-180,180]\\
\OSC{saturation} [S] 	& [0,100] & [-1,1] \\
\OSC{brightness} [B] 	& [0,100] & [-1,1] \\
\hline
\end{tabular}
\end{center}
\caption{Color components data ranges when expressed as integer or float.}
\label{colorrange}
\end{table}%


\example \\
The same alpha channel specified as integer value or as floating point value:
\sample{/ITL/scene/myObject alpha 51 ;\\
/ITL/scene/myObject alpha 0.2 ;
}

\subsublevel{The color messages}
\label{colormsg}

\index{Common messages!color}

\begin{rail}
color :		'color' ( [1] ('r' 'g' 'b') | [2] ('r' 'g' 'b' 'a') | [3] 'name' | [4] 'hexValue' ) 
\end{rail}

\OSC{color} sets an object color in the RGBA space. The color can be specified in different ways:
\begin{itemize}
\item \textbf{1} sets the color using RGB values. Alpha is not specified and the color is assumed to be opaque. 
\item \textbf{2} sets the color using RGBA values.  
\item \textbf{3} sets the color using a name among html defined names (see at \url{https://www.w3schools.com/colors/colors_names.asp}). Name is not case sensitive.
\item \textbf{4} sets the color using a single hexadecimal value in the form \OSC{0xrrggbb} or \OSC{0xrrggbbaa}.
\end{itemize}

The default color value is \values{[0,0,0,255]}.


\subsublevel{The hsb messages}
\label{hsbmsg}

\index{Common messages!hsb}

\begin{rail}
hsb :		'hsb' ('h' 's' 'b' | 'h' 's' 'b' 'a') 
\end{rail}

\OSC{hsb} sets an object color in the HSBA space. 
When A is not specified, the color is assumed to be opaque. 



%-------------------------------
%:    Relative color messages
\subsublevel{Relative color messages}
\label{relcolormsg}

\index{Position messages!color!dcolor}
\index{Position messages!color!dhsb}
\index{Position messages!color!dred}
\index{Position messages!color!dgreen}
\index{Position messages!color!dblue}
\index{Position messages!color!dhue}
\index{Position messages!color!dsaturation}
\index{Position messages!color!dbrightness}
\index{Position messages!color!dalpha}

\begin{rail}
relColorMsg :  
		 	('dcolor' color) 
		| 	('dhsb' hsb) 
		| 	('dred' colorvalue) 
		| 	('dgreen' colorvalue) 
		| 	('dblue' colorvalue) 
		| 	('dhue' colorvalue) 
		| 	('dsaturation' colorvalue) 
		| 	('dbrightness' colorvalue) 
		| 	('dalpha' colorvalue) 
\end{rail}

\begin{itemize}
\item \OSC{dred}, \OSC{dgreen}, etc. messages are similar to \OSC{red}, \OSC{green}, etc. messages but the parameters values represent a displacement of the current target value.
\item \OSC{dcolor} and \OSC{dhsb} are similar and each color parameter represents a displacement of the corresponding target value.
\end{itemize}

\example \\
Moving a color in the RGBA space:
\sample{TL/scene/myObject dcolor 10 5 0 -10 ,}
\sampleindent will increase the red component by 10, the blue component by 5, and decrease the transparency by 10.

\note{} Objects that are carrying color information (images, SVG) don't respond to color change but are sensitive to transparency changes.


%-------------------------------
%:    Pen control
\sublevel{Pen control}
\label{pencontrol}

Pen messages accepted by all the components and result in 2 different behaviors:
\begin{itemize}
\item for components types \OSC{rect | ellipse | polygon | curve | line | graph | fast graph | grid}, it makes the object border visible using the pen attributes;
\item for the other components and when the pen width is greater than 0, it makes the object bounding box visible.
\end{itemize}

\index{Specific messages! penColor}
\index{Specific messages! penAlpha}
\index{Specific messages! pendAlpha}
\index{Specific messages! penWidth}
\index{Specific messages! penStyle}

\begin{rail}
penMsg : 	  'penWidth' float32
			| 'penColor' color 
			| 'penStyle' penstyle
			| 'penAlpha' alphavalue
			| 'pendAlpha' alphavalue
\end{rail}

\begin{itemize}
\item \OSC{penWidth} controls the pen width. The default value is 0 (excepted for \OSC{line} objects, where 1.0 is the default value). It is expressed in arbitrary units (1 is a reasonable value).
\item \OSC{penColor} controls the pen color. The color should be given in the RGBA space. The default value is opaque black (0 0 0 255).
\item \OSC{penStyle} controls the pen style.
\item \OSC{penAlpha, pendAlpha} controls the pen transparency only. See section \fullref{colormsg} for the expected 
 \end{itemize}

\index{Specific messages! penStyle! solid}
\index{Specific messages! penStyle! dash}
\index{Specific messages! penStyle! dot}
\index{Specific messages! penStyle! dashDot}
\index{Specific messages! penStyle! dashDotDot}

\begin{rail}
penstyle : 'solid' | 'dash' | 'dot' | 'dashDot' | 'dashDotDot'
\end{rail}

The pen style default value is \OSC{solid}.\\

\example \\
Setting a rectangle border width and color:
\sample{/ITL/scene/rect set rect 0.5 0.5 ;\\
/ITL/scene/rect penWidth 2. ;\\
/ITL/scene/rect penColor 255 0 0 ;  
}

%-------------------------------
%:    The 'effect' messages
\sublevel{The 'effect' messages}
\label{effectmsg}

The \OSC{effect} message sets a graphic effect on the target object.

\index{Effect messages!effect!none}
\index{Effect messages!effect!blur}
\index{Effect messages!effect!colorize}
\index{Effect messages!effect!shadow}

\begin{rail}
effectMsg : 'effect' ( 'none'
		| ('blur'
		| 'colorize'
		| 'shadow') (| params)) 		
\end{rail}

\begin{itemize}
\item \OSC{none}: removes any effect set on the target object.
\item \OSC{blur, colorize, shadow}: sets the corresponding effect. An effect always replaces any previous effect. The effect name is followed by optional specific effects parameters.
\end{itemize}

\note{} An effect affects the target object but also all the target slaves.

\subsublevel{The blur effect}
\label{eblur}

\begin{rail}
blurParams : int32 (| blurHint)
\end{rail}

Blur parameters are the blur radius and a rendering hint. The radius is an int32 value. By default, it is 5 pixels. The radius is given in device coordinates, meaning it is unaffected by scale. 

\begin{rail}
blurHint : 'performance' | 'quality' | 'animation'
\end{rail}
Use the \OSC{performance} hint to say that you want a faster blur, the \OSC{quality} hint to say that you prefer a higher quality blur, or the \OSC{animation} when you want to animate the blur radius. The default hint value is \OSC{performance}.

\example \\
Setting a 8 pixels effect on \OSC{myObject}
\sample{/ITL/scene/myObject effect blur 8;}

\subsublevel{The colorize effect}
\label{ecolorize}

\begin{rail}
colorizeParams : float32 (| color)
\end{rail}

Colorize parameters are a strength and a tint color. The strength is a float value. By default, it is 1.0. A strength 0.0 equals to no effect, while 1.0 means full colorization. \\
The color is given as a RGB triplet (see section \fullref{colormsg}) by default, the color value is light blue (0, 0, 192).

\example \\
Setting a red colorize effect on \OSC{myObject} with a 0.5 strength.
\sample{/ITL/scene/myObject effect colorize 0.5 200 0 0;}


\subsublevel{The shadow effect}
\label{eshadow}

\begin{rail}
shadowParams : xoffset yoffset (| color (| blur))
\end{rail}

\OSC{xoffset} and \OSC{yoffset} are the shadow offset and should be given as int32 values. The default value is 8 pixels. The offset is given in device coordinates, which means it is unaffected by scale. \\
The color is given as a RGBA color (see section \fullref{colormsg}) by default, the color value is a semi-transparent dark gray (63, 63, 63, 180) \\
The blur radius should be given as an int32 value. By default, the blur radius is 1 pixel.

\example \\
Setting a shadow effect on \OSC{myObject}. \\
The shadow offset is (10,10) pixels, the color is a transparent grey (100,100,100, 50) and the blur is 8 pixels.
\sample{/ITL/scene/myObject effect shadow 10 10 100 100 100 50 8;}

%-------------------------------
%:    The 'edit' message
\sublevel{The 'edit' message}
\label{editmsg}

The \OSC{edit} message opens a small editor that allows to edit the target object attributes.

\index{Common messages!edit}

\begin{rail}
editMsg : 'edit' ( [1] | 
					 [2] ( attributes +) |
					 [3] reset )
\end{rail}

\begin{itemize}
\item \textbf{1}: without argument, the editor is initalized with all the target object attributes.
\item \textbf{2}: using a list of attributes, the editor is initalized with the target object corresponding attributes. Note that \OSC{set} as attribute can be used to edit the object \OSC{set} message.
\item \textbf{3}: \OSC{reset} is used to clear the edit string stored in the object cache. It is equivalent to the 'clear' button in the edit dialog. Note that as long as the edit string stored in the cache is not empty, \OSC{edit} messages are ignored unless followed by a \OSC{reset} (see below).
\end{itemize}

Each object maintains the current content of the editor, that is initialized at first \OSC{edit} message or when this content is cleared. Successive call to \OSC{edit} will preserve the editor content unless it is cleared.

\note Since the editor preserves its content, it doesn't take account of changes that may result from received messages and thus may not reflect the target object changes. To synchronize the editor content with the current attributes values, you can clear the editor content, which will refresh the attributes to their current values.

\note Although initialized with the target object attributes, the editor supports arbitrary INScore messages, i.e. addressed to any other object or even making use of extended OSC addresses.

\example \\
Editing an object on double click:
\sample{/ITL/scene/myObject watch doubleClick (/ITL/scene/myObject edit);}
Editing some specific attributes:
\sample{/ITL/scene/myObject watch doubleClick (/ITL/scene/myObject edit x y);}



%===============================
%:Time management messages
\toplevel{Time management messages}
\label{time}
%===============================
%:  Date and duration
\sublevel{Date and duration}
\label{datedur}
Time messages control the time dimension of the score components. They could be sent to any address with the form \OSC{/ITL/\textit{scene}/\textit{identifier}} where \OSC{\textit{identifier}} is the unique identifier string of a scene component.

\index{Time messages!absolute!date}
\index{Time messages!absolute!duration}
\index{Time messages!relative!ddate}
\index{Time messages!relative!dduration}
\index{Time messages!relative!clock}
\index{Time messages!relative!durClock}

\begin{rail}
timeMsg : 'clock'
		| 'durClock' 
		| ('date' time)
		| ('duration' time) 
		| ('ddate' time) 
		| ('dduration' time) 
\end{rail}

\begin{rail}
time : (([1] int32 int32) | [2] int32 | [3] float32 | [4] 'n/d')
\end{rail}

\begin{itemize}
\item 1) Time is specified as a rational value \values{d/n} where \values{1/1} represents a whole note. 
\item 2) Time may be specified with a single integer, then 1 is used as implicit denominator value.
\item 3) Time may be specified as a single float value that is converted using the following approximation: let \values{f} be the floating point date, the corresponding rational date is computed as \values{f x 10000 / 10000}.
\item 4) Time may also be specified as a string in the form \OSC{'n/d'}.
\end{itemize}

\begin{itemize}
\item \OSC{clock}: similar to MIDI clock message: advances the object date by 1/24 of quarter note.
\item \OSC{durClock}: a clock message applied to duration: increases the object duration by 1/24 of quarter note.
\item \OSC{date}: sets the time position of an object. Default value is \values{0/1}.
\item \OSC{duration}: changes the object duration. Default value is \values{1/1}.
\item \OSC{ddate}: relative time positioning message: adds the specified value to the object date.
\item \OSC{dduration}: relative duration message: adds the specified value to the object duration.
\end{itemize}


\example \\
Various ways to set an object date.
\sample{/ITL/scene/myObject date 2 1 ;\\
/ITL/scene/myObject date 2;     \hspace{1.2cm}! the denominator is 1 (implied) \\
/ITL/scene/myObject date 0.5;   \hspace{7mm} ! equivalent to 1/2 \\
/ITL/scene/myObject date '1/2'; \hspace{4mm} ! the string form
}
Similar ways to move an object date.
\sample{/ITL/scene/myObject clock;   \\
/ITL/scene/myObject ddate '1/96';
}

%===============================
%:  Tempo
\sublevel{Tempo}
\label{tempo}
The \OSC{tempo} message is supported by all the score components. Its default value is 0. When non null, the date of an object is moved at the corresponding tempo (e.g. with a tempo = 60, the date move will be 1/4 - a quarter note - every second). Note that the date is refreshed at INScore time task rate.

\index{Time messages!tempo}

\begin{rail}
tempoMsg : 'tempo' val
		| 'dtempo' val
\end{rail}

\begin{itemize}
\item \OSC{tempo}: set an object tempo. Default value is 0.
\item \OSC{dtempo}: relative tempo message: adds the specified value to the object tempo.
\end{itemize}

\example \\
A cursor moving over a score using the \OSC{tempo} message.
\sample{/ITL/scene/score set gmn "[a a a a a a]"; 	\hspace{3mm} \icomment a short score \\
/ITL/scene/cursor set ellipse 0.5 0.5;   			\hspace{7.5mm} \icomment a cursor \\
/ITL/scene/sync cursor score;   					\hspace{22mm} \icomment synchonizes the cursor to the score \\
/ITL/scene/cursor tempo 80; 						\hspace{25.5mm} \icomment an set the tempo
}


%===============================
%:Miscellaneous messages
\toplevel{Miscellaneous messages}
\label{miscmsgs}

The following messages are supported by all the objects. They are detailled in specialized sections.

\index{Misc messages!eval}
\index{Misc messages!watch}
\index{Misc messages!push}
\index{Misc messages!pop}
\index{Misc messages!map}

\begin{rail}
miscMsgs :  
		 	"eval" msgsList
		|   "watch" (| what ( | msgsList ))
		| 	"push"
		| 	"pop"
		| 	"map" ( | mapName ) (relation | ( del ))
\end{rail}

\begin{itemize}
\item \OSC{eval}: evaluates a list of messages in the context of the receiver object. See section \fullref{scriptmsgs} for more details.
\item \OSC{watch}: used to manage the object interaction with various events. See section \fullref{interaction} for more details.
\item \OSC{push}, \OSC{pop}: saves and restores the object interaction state. See section \fullref{evtstate} for more details.
\item \OSC{map}: used to describe the relations between graphic and time spaces. See section \fullref{mapping} for more details.
\end{itemize}



%===============================
%:The 'set' message
\toplevel{The 'set' message}
\label{setsect}
The \OSC{set} messages can be sent to any address with the form \OSC{/ITL/scene/\textit{identifier}}. The global form of the message is:

\begin{rail}
setMsg : 'set' type data
\end{rail}

It sets a \OSC{scene} component data. 

When there is no destination for the OSC address, the component is first created before being given the message. 

When the target destination type doesn't correspond to the message \OSC{type}, the object is replaced by an adequate object.

%===============================
%:  Symbolic music notation
\sublevel{Symbolic music notation}
\label{symscore}

Symbolic music notation support is based on the Guido Music Notation format [GMN] or on the MusicXML format. MusicXMl is supported via conversion to the GMN format when the MusicXML library is present.

\index{Common messages!set}
\index{Set type!gmn}
\index{Set type!gmnf}
\index{Set type!gmnstream}
\index{Set type!musicxml}
\index{Set type!musicxmlf}

\begin{rail}
setScore : 'set' (
	('gmn' gmnString) |
	('gmnf' gmnFilePath) |
	('gmnstream' gmnStream) |
	('musicxml' xmlString) |
	('musicxmlf' xmlFilePath) |
	('gmn' 'expr' scoreExpression)
)
\end{rail}

\begin{itemize}
\item \OSC{gmn}: a Guido score defined by a GMN string.
\item \OSC{gmnf}: a Guido score defined by a GMN file.
\item \OSC{gmnstream}: a Guido score defined by a GMN stream (a GMN string that can be written in several times).
\item \OSC{musicxml}: a score defined by a MusicXML string.
\item \OSC{musicxmlf}: a score defined by a MusicXML file.
\item \OSC{gmn expr}: a score defined by a \emph{score expression}. See section \fullref{scoreExpr} for the score expressions reference.
\end{itemize}

\example \\
Creating a music score using a Guido Music Notation language string.
\sample{/ITL/scene/myObject set gmn "[ a b g ]";}
Creating the same music score as a stream.
\sample{/ITL/scene/myObject set gmnstream "[ a";\\
/ITL/scene/myObject write "b";\\
/ITL/scene/myObject write "g";
}

\note{} For compatibility with previous versions, passing a MusicXML string to a \OSC{gmn} object or a MusicXML file to a \OSC{gmnf} object may succed since the system tries to parse the content as GMN content or as MusicXML content when the former fails.

\note{} Conversion from MusicXML to GMN could be achieved manually using a command line tool that is distributed with the MusicXML library (see at \url{https://github.com/dfober/libmusicxml}). It allows to improve the output GMN code afterhand.

%===============================
%:  Piano roll music notation
\sublevel{Piano roll music notation}
\label{pianorollscore}
Piano roll music notation is based on the Guido Music Notation format [GMN].

\index{Common messages!set}
\index{Set type!pianoroll}
\index{Set type!pianorollstream}
\index{Set type!pianorollf}

\begin{rail}
setPianoRoll : 'set' (
	('pianoroll' gmnString) |
	('pianorollstream' gmnStream) |
	('pianorollf' filePath) |
	('pianoroll' 'expr' scoreExpression)
)
\end{rail}

\begin{itemize}
\item \OSC{pianoroll}: a piano roll defined by a GMN string.
\item \OSC{pianorollstream}: a piano roll defined by a GMN stream (a GMN string that can be written in several times).
\item \OSC{pianorollf}: a piano roll defined by a guido file (with ".gmn" extension) or by a midi file (with ".mid" extension). Warning: url forms are not supported for midi files.
\item \OSC{pianoroll expr}: a piano roll defined by a \emph{score expression}. See section \fullref{scoreExpr} for the score expressions reference.
\end{itemize}

\example \\
Creating a pianoroll using a Guido Music Notation language string.
\sample{/ITL/scene/myObject set pianoroll "[ a b g ]";}
Creating the same piano roll as a stream.
\sample{/ITL/scene/myObject set pianorollstream "[ a";\\
/ITL/scene/myObject write "b";\\
/ITL/scene/myObject write "g";
}

%===============================
%:  Textual components
\sublevel{Textual components}
\label{textscore}

\index{Set type!txt}
\index{Set type!html}
\index{Set type!txtf}
\index{Set type!htmlf}

\begin{rail}
setText : 'set' (
	('txt' (string | txtStream)) |
	('txtf' textFilePath) |
	('html' string) |
	('htmlf' htmlFilePath)
)
\end{rail}

\begin{itemize}
\item \OSC{txt}: a textual component.
\item \OSC{txtf}: a textual component defined by a file.
\item \OSC{html}: an html component defined by an HTML string.
\item \OSC{htmlf}: an html component defined by an HTML file.
\end{itemize}

Text may be specified by a single quoted string or using an arbitrary count of parameters that are converted to a single string with a space used as separator.
\begin{rail}
txtStream :  (string | int32 | float32) +
\end{rail}

\example \\
Creating a text object.
\sample{/ITL/scene/myObject set txt "Hello ...    world!";}
Setting the content of a text object using a values stream.
\sample{/ITL/scene/myObject set txt Hello 1 world and 0.5; }


%===============================
%:  Vectorial graphics
\sublevel{Vectorial graphics}
\label{vgraphscore}

\index{Set type!svg}
\index{Set type!svgf}
\index{Set type!rect}
\index{Set type!ellipse}
\index{Set type!polygon}
\index{Set type!curve}
\index{Set type!arc}
\index{Set type!line}

\begin{rail}
setVGraphics : 'set' (
	('svg' svgString) |
	('svgf' svgFilePath) |
	('rect' width height) |
	('ellipse' width height) |
	('polygon' ( (x y) +)) |
	('curve' ((x1 y1 x2 y2 x3 y3 x4 y4) +)) |
	('arc' width height startAngle endAngle) |
	('line' ('xy' x y | 'wa' width angle))
)
\end{rail}

\begin{itemize}
\item \OSC{svg}: SVG graphics defined by a SVG string.
\item \OSC{svgf}: vectorial graphics defined by a SVG file.
\item \OSC{rect}: a rectangle specified by a width and height. Width and height are expressed in \OSC{scene} coordinates space, thus a width or a height of 2 corresponds to the width or a height of the \OSC{scene}.
\item \OSC{ellipse}: an ellipse specified by a width and height.
\item \OSC{polygon}: a polygon specified by a sequence of points, each point being defined by its (x,y) coordinates. The coordinates are expressed in the \OSC{scene} coordinate space, but only the relative position of the points is taken into account (\emph{i.e} a polygon A = \{ (0,0) ; (1,1) ; (0,1) \} is equivalent to a polygon B = \{ (1,1) ; (2,2) ; (1,2) \}).
\item \OSC{curve}: a sequence of 4-points bezier cubic curve. If the end-point of a curve doesn't match the start-point of the following one, the curves are linked by a straight line. The first curve follows the last curve. The inner space defined by the sequence of curves is filled, using the object color. The points coordinates are handled like in a \OSC{polygon}.
\item \OSC{arc}: an arc defined by its enclosing rectangle and the start and end angles. Angles are in degrees and express counter-clockwise directions.
\item \OSC{line}: a simple line specified by a point (x,y) expressed in \OSC{scene} coordinate space or by a width and angle. The point form is used to compute a line from (0,0) to (x,y), which is next drawn centered on the scene.
\end{itemize}

\example \\
Creating a rectangle with a 0.5 width and a 1.5 height.
\sample{/ITL/scene/myObject set rect 0.5 1.5;}
Creating a line specified using width and angle.
\sample{/ITL/scene/myObject set line wa 1. 45.;}


%===============================
%:  Signals and graphic signals
\sublevel{Signals and graphic signals}
\label{sigscore}

Signals are special objects that are stored in a special \OSC{signal} node and that may be composed in parallel to produce graphic signals. Signals and graphic signals are decribed in section \fullref{graphsig}.

Signals and computation on signals may be based on FAUST objects that are actually signals processors. FAUST objects are decribed in section \fullref{faust}. \\
For more information about the FAUST language, see at \url{http://faust.grame.fr}.

\index{Set type!graph}
\index{Set type!fastgraph}
\index{Set type!faust}
\index{Set type!faustdsp}

\begin{rail}
setGraphicSignal : 'set' (
	('graph' signals ) |
	('fastgraph' signals ) |
	('faust' 'pluginname' ) |
	('faustdsp' faustcode ) |
	('faustdspf' faustfile)
)
\end{rail}

\begin{itemize}
\item \OSC{graph}: graphic of a signal. See section \fullref{graphsig} for details about the \OSC{graph} objects data.
\item \OSC{fastgraph}: fast rendering graphic signal. See also section \fullref{graphsig}.
\item \OSC{faust}: a FAUST object as a plugin (see section \ref{faust})
\item \OSC{faustdsp}: a FAUST object defined by a string (see section \fullref{faust})
\item \OSC{faustdspf}: a FAUST object defined by a file (see section \fullref{faust})
\end{itemize}


%===============================
%:  Images and video
\sublevel{Images and video}
\label{imgscore}

Images and video are supported using various formats. See section \fullref{fileset} for more details on the supported formats.

\index{Set type!img}
\index{Set type!memimg}
\index{Set type!video}

\begin{rail}
setMedia : 
	('img' imgPath) |
	('memimg' objectPath) |
	('video' videoPath)
\end{rail}

\begin{itemize}
\item \OSC{img}: an image file. The image format is infered from the file extension.
\item \OSC{memimg}: a memory capture of the object given as argument. \OSC{objectPath} indicates the target object that is captured with all its childrens. It may be an object name or a path to an object. Simple object names and relative path are looked for in the receiver layer.
\item \OSC{video}: a video file. The video format is infered from the file extension. Note that navigation through the video is made using its \OSC{date}.
\end{itemize}

\example \\
Creating an image.
\sample{/ITL/scene/myObject set img "myImage.png";}
Creating a memory image of a scene.
\sample{/ITL/scene/myObject set memimg "/ITL/scene";}

\note{} \\
It is necessary to have an object or scene graphically rendered before a capture can be made. Since the actual graphic rendering is made asynchronously to the model update, a sequence of messages like the following:
\sample{/ITL/scene/myObject set gmn "[a f g]";\\
/ITL/scene/capture set memimg myObject;
}
won't work if the messages are handled by the same time task. A delay is necessary between the two messages. To make sure all the objects have been rendered, you can use the scene \OSC{endPaint} event.


%===============================
%:  Miscellaneous
\sublevel{Miscellaneous}
\label{miscscore}

\index{Set type!layer}
\index{Set type!grid}

\begin{rail}
setMisc : 'set' (
	'layer'  |
	('grid' int32 int32)
)
\end{rail}

\begin{itemize}
\item \OSC{layer}: a graphic layer, may be viewed as a container (see section \fullref{layers}).
\item \OSC{grid}: a white transparent object that provides a predefined time to graphic mapping (see section \fullref{grid} for more details and section \fullref{mapping} for time to graphic relations). The parameters are int32 values representing the number of columns and rows.
\end{itemize}


%===============================
%:  File based resources
\sublevel{File based resources}
\label{filebasedrsrc}

Most of the types can be either expressed with the corresponding data, or by a path to a file containing the data. For the latter form, the object type is generally suffixed with an 'f' (e.g. \OSC{txtf}, \OSC{htmlf}, \OSC{gmnf}, \OSC{musicxmlf}, \OSC{svgf}, \OSC{faustf}). The \OSC{img} and  \OSC{video} types have only a file form (and no 'f' suffix). \\
A file path can be expressed as a Unix path (absolute or relative - see the scene or application \OSC{rootPath} message for relative paths handling), but also as an URL.
Only the \OSC{http:} protocol is currently supported.

When the system encounters an URL, it creates an intermediate object that is in charge of retrieving the corresponding data. This object has a specific \OSC{url} type that takes the target type and an url as arguments. It has a graphic appearance (actually a light gray box containing the object name and the target url) that can be controled like for any regular object.

\index{Set type!url}

\begin{rail}
urlType : 
	'url' targetType  urlPath
\end{rail}

The \OSC{url} intermediate object acts as a proxy for the target object and will transfer all its properties once the data are ready. A client can thus interact transparently with the target adress, whatever the status of the download request.

\example \\
Creating a score using an URL:
\sample{/ITL/scene/score set gmnf "http://anyhost.adomain.org/score.gmn"; \\
\hspace*{4mm} is equivalent to \\
/ITL/scene/score set url gmnf "http://anyhost.adomain.org/score.gmn";
}

\note{} The \OSC{url} object handles specific events : \OSC{success}, \OSC{error} and \OSC{cancel} (see the section \fullref{urlevents}).


%===============================
%:  The file type
\sublevel{The file type}
\label{fileset}
\label{setfile}

\index{Set type!file}

\begin{rail}
setFile : 
	('file' (filePath | urlPath))
\end{rail}

\begin{itemize}
\item \OSC{file}: a generic type to handle file based objects. Actually, the \OSC{file} type is translated into a one of the \OSC{txtf}, \OSC{gmnf}, \OSC{img} or \OSC{video} types, according to the file extension (see table \ref{fileTranslate}).
\end{itemize}

\seealso the application \OSC{rootPath} message (section \fullref{ITL}) for file based objects.

\begin{table}[htbp]
\caption{File extensions supported by the \OSC{file} translation scheme.}
\begin{center}
\begin{tabular}{|r|c|}
\hline
file extension & translated type \\
\hline
\OSC{.txt .text}		& \OSC{txtf} \\
\OSC{.htm .html}		& \OSC{htmlf} \\
\OSC{.gmn}			& \OSC{gmnf} \\
\OSC{.xml}			& \OSC{musicxmlf} \\
\OSC{.svg} 			& \OSC{svgf} \\
\OSC{.jpg .jpeg .png .gif .bmp .tiff} & \OSC{img} \\
\OSC{.avi .wmv .mpg .mpeg .mp4 .mov .vob} & \OSC{video} \\
\OSC{.dsp} 			& \OSC{faustdspf} \\
\hline
\end{tabular}
\end{center}
\label{fileTranslate}
\end{table}

\example \\
Creating an image using the \OSC{file} type.
\sample{/ITL/scene/myObject set file "myImage.png"; \\
\hspace*{4mm} is equivalent to \\
/ITL/scene/myObject set img "myImage.png";
}

%===============================
%:  Web objects
\sublevel{Web objects}
\label{webobjects}

A score can make its content available to the Internet using specific components that provide an image of the scene over http or websocket protocols.

The \OSC{httpd} server depends on the Httpd server plugin and is described in section \fullref{Httpd}.

The \OSC{websocket} server provides a two-ways communication between INScore and distant clients. The server sends notifications to client using a \OSC{Screen updated} text message when the scene is updated. Clients can request an image by sending a \OSC{getImage} text message to the server. The server responds with a image of the scene in png format, using a Blob type javascript object.

\index{Set type!websocket}
\index{Set type!httpd}

\begin{rail}
webobject :   'websocket' port frequency
			| 'httpd' port
\end{rail}

\begin{itemize}
\item \OSC{port}: a port number for the socket communication.
\item \OSC{frequency}: a minimum time in millisecond between two \OSC{Screen updated} notifications.
\end{itemize}

\note{} \\
A busy port prevents the server to start. The server status can be checked with the \OSC{get status} message.

\example \\
Creating an websocket server using the port \OSC{1234} and limiting the notifications rate to one per 500 milliseconds.
\sample{/ITL/scene/myObject set websocket 1234 500;}

\seealso the http web server plugin (section \fullref{Httpd}).



%===============================
%:The 'get' message
\toplevel{The 'get' messages}
\label{getsect}

%-------------------------------
The \OSC{get} messages can be sent to any valid OSC address. It is intended to query the system state. It is the counterpart of all the messages modifying this state.  The result of the query is sent to the OSC output port with the exact syntax of the counterpart message. 
The global form of the message is:

\index{Common messages!get}

\begin{rail}
getMsg : 'get' ( | getParam +)
\end{rail}

The \OSC{get} message without parameter is the counterpart of the \OSC{set} message. When addressed to a container (the application \OSC{/ITL}, a scene \OSC{/ITL/scene}, the signal node \OSC{/ITL/scene/signal}) is also distributed to all the container components.

Specific \OSC{get} forms may be available, depending on the component type (see sections \ref{gmnpage},  \ref{ITLQuery}, \ref{ITLdebug}, \ref{syncmsg}, \ref{parcomp}, \ref{faustmsg}).

The \OSC{get frame} message is supported by all the components. An object frame is available for read only. It represents the polygon that encloses the object, taking account of scaling, rotations, and shear. The polygon is returned as a set of 4 points (x, y) expressed in the parent object coordinates space.

\example \\
Sending the following request to an object which position is 0.3 0.5
\sample{/ITL/scene/myobject get x y;}
\sampleindent will give the following messages on outpout port:
\sample{/ITL/scene/myobject x 0.3; \\
/ITL/scene/myobject y 0.5;}
Querying an object content
\sample{/ITL/scene/myobject get;}
\sampleindent will give the corresponding \OSC{set} message:
\sample{/ITL/scene/myobject set txt "Hello world!";}
Querying an object frame
\sample{/ITL/scene/myobject get frame;}
\sampleindent will give the corresponding \OSC{frame} message:
\sample{/ITL/scene/myobject frame -0.5 -0.25 0.50 -0.25 0.50 0.25 -0.5 0.25;}


\note{} \\
The \OSC{get width} and \OSC{get height} messages addressed to components that have no explicit width and height (text, images, etc.) returns 0 as long as the target component has not been graphically rendered.


%===============================
%:Type specific messages
\toplevel{Type specific messages}
\label{specificMsg}
Some of the messages are accepted only by specific components.


%-------------------------------
%:  Brush control
\sublevel{Brush control}
\label{brush}

\begin{figure}[h]
	\centering \includegraphics{imgs/brush}
 \caption{Brush styles}
 \label{brushstyle}
\end{figure}

Specific brush messages accepted by the following components: \OSC{rect | ellipse | polygon | curve |  layer}.

\index{Specific messages! brushStyle}
\index{Specific messages! brushStyle! solid}
\index{Specific messages! brushStyle! dense}
\index{Specific messages! brushStyle! dense2}
\index{Specific messages! brushStyle! dense3}
\index{Specific messages! brushStyle! dense4}
\index{Specific messages! brushStyle! dense5}
\index{Specific messages! brushStyle! dense6}
\index{Specific messages! brushStyle! dense7}
\index{Specific messages! brushStyle! none}
\index{Specific messages! brushStyle! hor}
\index{Specific messages! brushStyle! ver}
\index{Specific messages! brushStyle! cross}
\index{Specific messages! brushStyle! bdiag}
\index{Specific messages! brushStyle! fdiag}
\index{Specific messages! brushStyle! diagCross}
\index{Specific messages! brushStyle! linearCross}

\begin{rail}
brushMsg : 	  'brushStyle' ('solid' | 'dense1' | 'dense2' | 'dense3' | 'dense4' | 'dense5' | 'dense6' | 'dense7' | 'none' | 'hor' | 'ver' | 'cross' | 'bdiag' | 'fdiag' | 'diagCross')
\end{rail}

\begin{itemize}
\item \OSC{brushStyle} controls the brush style (see figure \ref{brushstyle}).
\end{itemize}

The brush style default value is \OSC{solid}.\\
For the \OSC{layer} object, the brush style default value is \OSC{none}.\\

\example \\
Setting a rectangle style :
\sample{/ITL/scene/rect set rect 0.5 0.5 ;\\
/ITL/scene/rect brushStyle dense4; 
}


%-------------------------------
%:  Width and height control
\sublevel{Width and height control}
\label{whcontrol}

\OSC{width} and \OSC{height} messages are accepted by the following components: \OSC{rect | ellipse | arc | graph | fastgraph | grid | pianoroll | pianorollf}.

\index{Specific messages! width}
\index{Specific messages! height}

\begin{rail}
widthMsg :  'width' float32
			| 'height' float32
\end{rail}

\note 
Querying the \OSC{width} and \OSC{height} of any object is always supported, provided that the object has been graphically rendered.


%-------------------------------
%:  Symbolic score 
\sublevel{Symbolic score}
\label{gmnpage}

The following messages are accepted by the components types \OSC{gmn | gmnstream | gmnf}. 

\index{Specific messages! score! page}
\index{Specific messages! score! dpage}
\index{Specific messages! score! pageFormat}
\index{Specific messages! score! columns}
\index{Specific messages! score! rows}
\index{Specific messages! score! pageCount}
\index{Specific messages! score! systemCount}

\begin{rail}
scoreMsg :      'page' int32
			| 'dpage' int32
			| 'pageFormat' float32 float32
			| 'columns' int32
			| 'rows' int32
			| 'get' ( 'pageCount'| 'systemCount' )
\end{rail}

\begin{itemize}
\item \OSC{page}: set the score current page
\item \OSC{dpage}: moves the score current page
\item \OSC{pageFormat}: set the page format. The parameters are the page width and height. Note that the message has no effect when the score already includes a \verb+\+pageformat tag.
\item \OSC{columns}: for multi pages display: set the number of columns.
\item \OSC{rows}: for multi pages display: set the number of rows.
\item \OSC{pageCount}:  a read only attribute, gives the score pages count.
\item \OSC{systemCount}:  a read only attribute, gives the number of systems on each of the score pages. The result is given as a list systems count ordered by page number (index 0 is page 1, etc.).
\end{itemize}


\example \\
Displaying a multi-pages score on two pages starting at page 3:
\sample{/ITL/scene/myScore columns 2 ;\\
/ITL/scene/myScore page 3 ;
}

\index{Specific messages! score! write}
\index{Specific messages! score! clear}

\begin{rail}
gmnstreamMsg :      'write' gmnCode
				| 'clear' 
\end{rail}

\begin{itemize}
\item \OSC{write}: add the gmn code to the current gmn stream
\item \OSC{clear}: reinitialize the stream
\end{itemize}


\example \\
Writing a score in 3 steps:
\sample{/ITL/scene/myScore set gmnstream "[ c"; \\
/ITL/scene/myScore write " d e";\\
/ITL/scene/myScore write " f]";
}


%-------------------------------
%:  piano roll 
\sublevel{Piano roll}
\label{pianoroll}

The following messages are accepted by the components types \OSC{pianoroll | pianorollstream | pianorollf}.

\index{Specific messages! pianoroll! keyboard}
\index{Specific messages! pianoroll! autoVoicesColoration}
\index{Specific messages! pianoroll! measureBars}
\index{Specific messages! pianoroll! voiceColor}
\index{Specific messages! pianoroll! pitchLines}
\index{Specific messages! pianoroll! clipTime}
\index{Specific messages! pianoroll! clipPitch}

\begin{rail}
pianorollMsg :		'keyboard' int32
			| 'autoVoicesColoration' int32
			| 'measureBars' int32
			| 'voiceColor' (int32 (color |) |)
			| 'pitchLines' ( 'Notes' |)
			| 'clipTime' (time time |)
			| 'clipPitch' (int32 int32 |)
\end{rail}

\begin{itemize}
\item \OSC{keyboard}: display the keyboard on left of piano roll. Default value to 0.
\item \OSC{autoVoicesColoration}: enable voices automatic coloration. If voiceColor is used for a voice, automatic voices coloration do nothing for it. Default value to 0.
\item \OSC{measureBars}: Display measure bars on piano roll. Default value to 0.
\item \OSC{voiceColor}: set a color to a voice. The parameters are voice number (start to 1), and RGBA color (See section \fullref{colormsg}). If not color is present, voice color is reset to default color. If voice number and color are not present, reset all voices to default color.
\item \OSC{pitchLines}:  Display pitch lines on pianoroll. Parameters are a note list in english notation (A A\# B ...) with case insensitive. Default to all lines. An '\OSC{empty}' note (i.e. the litteral '\OSC{empty}' string)  can be used to not display any line.
\item \OSC{clipTime}: set time limits for piano roll (See section \fullref{time} to set a time). The two times have to be wrote in the same format. If no time is present, time limits are reset to default.
\item \OSC{clipPitch}:  Set pitch limits to piano roll. The pitch is in midi format. If no value is present, pitch limits are reset to default.
\end{itemize}


\example \\
Set a color on voice 2 with transparency and display C and F pitch lines: 
\sample{/ITL/scene/myPianoroll voiceColor 2 154 234 45 100;\\
/ITL/scene/myPianoroll pitchLines 'C' 'F';
}
Removes the pitch lines: 
\sample{/ITL/scene/myPianoroll pitchLines empty;
}

Piano roll streams support the same messages than Guido streams:

\index{Specific messages! pianoroll! write}
\index{Specific messages! pianoroll! clear}

\begin{rail}
pianorollstreamMsg :      'write' gmnCode
				| 'clear' 
\end{rail}

\begin{itemize}
\item \OSC{write}: add the gmn code to the current gmn stream
\item \OSC{clear}: reinitialize the stream
\end{itemize}


\example \\
Writing a pianoroll in 3 steps:
\sample{/ITL/scene/myPianoroll set pianorollstream "[ c"; \\
/ITL/scene/myPianoroll write " d e";\\
/ITL/scene/myPianoroll write " f]";
}

%-------------------------------
%:  Video
\sublevel{Video}
\label{video}

A video object has an own internal time and duration that is independant from the INScore time and duration. 
This video time is controlled using specific messages.

\index{Specific messages! video! play}
\index{Specific messages! video! volume}
\index{Specific messages! video! rate}
\index{Specific messages! video! vdate}

\begin{rail}
video :	'play' int32
		| volume float32
		| rate   float32
		| vdate  ( [1] int32 | [2] (int32 int32) | [3] float)
\end{rail}

\begin{itemize}
\item \OSC{play} start or stop playing the video. Default value is 0. 
\item \OSC{volume} sets the audio volume of the video. Default and maximum value is 1.
\item \OSC{rate} sets the video playing rate. Default value is 1.
\item \OSC{vdate} sets the current video frame. Default value is 0. Arguments are the following:
\begin{itemize}
\item \textbf{1} : a value in milliseconds. 
\item \textbf{2} : a musical time expressed as a rational. Note that musical time is converted to milliseconds using a tempo value of 60. 
\item \textbf{3} : a musical time expressed as a float. 
\end{itemize}
The video position may be updated while the video is playing.
\end{itemize}

A video object supports also specific queries: 

\index{Specific messages! video! vduration}

\begin{rail}
videoget :	'mls'
			| 'vduration'
\end{rail}

\begin{itemize}
\item \OSC{mls} gives the video absolute duration in milliseconds.
\item \OSC{vduration} gives the video duration in musical time. The returned value is a rational computed using the current rate, according to a tempo value of 60.
\end{itemize}

A video object supports specific events (see section \fullref{typespecevents} for more details). 
\\

\example \\
Playing a video at half speed:
\sample{/ITL/scene/video set video "Video.mp4"; \\
/ITL/scene/video rate 0.5;\\
/ITL/scene/video play 1";
}

\note \\
Depending on the video encoding and on the platform renderer, setting the video current position using the \OSC{vdate} message may be aligned to key frames.
\\
Supported video formats are highly dependent on the platform, as well as the video specific features (e.g. setting the playing rate that may or may not be supported, or may behave differently).  


%-------------------------------
%:  SVG Objects
\sublevel{SVG Objects}
\label{svgobjects}

The following message is accepted by the SVG components (types \OSC{svg | svgf}).

\index{Specific messages! svg! animate}
\index{Specific messages! svg! animated}

\begin{rail}
svgMsg :		'animate' int32
		| get 'animated'
\end{rail}

\begin{itemize}
\item \OSC{animate}: start or stop the svg animation (provided the SVG is animated). The parameter is a boolean value (default is 0).
\item \OSC{animated}: a \OSC{get} parameter only: returns whether the svg is animated or not.
\end{itemize}

\note\\
SVG objects are rendered using the Qt SVG Renderer and suffer the Qt limitations. For example and with Qt 5.5, xlinks are not supported.


%-------------------------------
%:  Rectangles
\sublevel{Rectangles}
\label{rectobjects}

Rectangles (type \OSC{rect}) accept a \OSC{radius} message that can be used to draw rounded rectangles.

\index{Specific messages! rect! radius}

\begin{rail}
radiusMsg :		'radius' float32 float32
\end{rail}

\begin{itemize}
\item \OSC{radius}: followed by 2 values that specify the radius on the x and y axis (default is 0 0). The values express a percentage of the object dimensions, thus the value's range is [0, 100].
\end{itemize} 


%-------------------------------
%:  Arcs
\sublevel{Arcs}
\label{arcobjects}

Arcs are portion of ellipses.
Although an arc is specified by it's \OSC{set} message, it supports additional messages to control the start angles and the arc extension individually. An additional \OSC{close} message affects the drawing of the arc.

\index{Specific messages! arc! start}
\index{Specific messages! arc! range}
\index{Specific messages! arc! dstart}
\index{Specific messages! arc! drange}
\index{Specific messages! arc! close}

\begin{rail}
arcMsg :	  'start' 	float32 
			| 'range' 	float32 
			| 'dstart'  float32 
			| 'drange' 	float32 
			| 'close'	int32
\end{rail}

\begin{itemize}
\item \OSC{start}: 	set the start angle of the arc.
\item \OSC{range}: 	set the arc extension in degrees counter-clockwise.
\item \OSC{dstart}: move the start angle of the arc from the value given as parameter.
\item \OSC{drange}: move the arc range from the value given as parameter.
\item \OSC{close}: 	by default, only the curve of an arc is drawn. When the \OSC{close} attribute is set, lines from the arc borders to the center of the ellipse are also drawn. The \OSC{close} parameter is read as a boolean value.
\end{itemize} 
Angles are in degrees and express counter-clockwise directions.


%-------------------------------
\sublevel{The 'grid' object}
\label{grid}

The \OSC{grid} object provides a pre-defined time to graphic mapping organized in columns and row. By default, it is not visible (white, transparent) but supports all the attributes of rectangles (color, pen, effects, etc.). Each element of a grid has a duration that is computed as the grid duration divided by the total number of elements ( columns x rows) and is placed in the time space from the date 0 to the end of the grid duration.

\begin{rail}
gridMsg : 'columns' int32
		| ('rows' int32) 
		| ('xborder' float)
		| ('yborder' float)
		| ('order' ('leftright' | 'topbottom'))
\end{rail}

\begin{itemize}
\item \OSC{columns} set the number of columns of the grid,
\item \OSC{rows} set the number of rows of the grid,
\item \OSC{xborder} set the horizontal spacing between the elements of the grid (default is 0.),
\item \OSC{yborder} set the vertical spacing between the elements of the grid (default is 0.),
\item \OSC{order} defines the time order of the elements. By default, elements are organized from left to right first and from top to bottom next (\OSC{leftright}). The \OSC{topbottom} parameter changes this order from top to bottom first and from left to right next.
\end{itemize}

\example \\
Creating a 10 x 10 grid organized from top to bottom with a border:
\sample{/ITL/scene/grid set grid 10 10 ;\\
/ITL/scene/grid xborder 3. ;\\
/ITL/scene/grid yborder 3. ;\\
/ITL/scene/grid order topbottom ;
}


%-------------------------------
%:  Arrows
\sublevel{Arrows}
\label{arrows}

Specific arrows message is accepted by the component type \OSC{line}. It add capability to draw arrow heads to the begining and the end of a line object.

\index{Specific messages! line! arrows}

\begin{rail}
arrowsheadMsg : 'arrows' arrowStyleBegin arrowStyleEnd 
\end{rail}

\begin{itemize}
\item \OSC{arrowStyleBegin} Set the arrow head of the begining of the line.
\item \OSC{arrowStyleEnd} Set the arrow head of the end of the line.
\end{itemize}
\begin{rail}
arrowStyle : 'none' | 'triangle' | 'diamond' | 'disk'
\end{rail}
The arrow style default value is \OSC{none}.

%-------------------------------
%:  Textual objects
\sublevel{Textual objects}
\subsublevel{Font control}
\label{fontctrl}
Specific font messages are accepted by \OSC{txt} \OSC{html} \OSC{txtf} and  \OSC{htmlf} components.

\index{Specific messages! fontSize}
\index{Specific messages! fontFamily}
\index{Specific messages! fontStyle}
\index{Specific messages! fontWeight}

\begin{rail}
fontMsg : 	  'fontSize' int32 
			| 'fontFamily' string
			| 'fontStyle' style
			| 'fontWeight' weight
\end{rail}

\index{Specific messages! fontStyle! normal}
\index{Specific messages! fontStyle! italic}
\index{Specific messages! fontStyle! oblique}

\begin{rail}
	fontStyle : 'normal' | 'italic' | 'oblique'
\end{rail}

\index{Specific messages! fontWeight! light}
\index{Specific messages! fontWeight! demibold}
\index{Specific messages! fontWeight! normal}
\index{Specific messages! fontWeight! bold}
\index{Specific messages! fontWeight! black}

\begin{rail}
	fontWeight : 'light' | 'demibold' | 'normal' | 'bold' | 'black'
\end{rail}

\begin{itemize}
\item \OSC{fontSize} controls the font size in pixel. The default value is 13px.
\item \OSC{fontFamily} controls the font family. The default value is 'Arial'. If a non existing value is used, system default font is used.
\item \OSC{fontStyle} controls the pen style. The font style default value is \OSC{normal}.\\
\item \OSC{weightValue} controls the font weight. The font weight default value is \OSC{normal}.
\end{itemize}

\example \\
Setting a text object with a font family Times and bold weight:
\sample{/ITL/scene/text set txt "text sample";\\
/ITL/scene/text fontFamily Times;\\
/ITL/scene/text fontWeight bold;  
}

\subsublevel{Writing}
\label{txtwrite}
Textual objects support writing in a stream-like way.

\index{Specific messages! write}

\begin{rail}
txtwrite :  'write' (arg +)
\end{rail}

\begin{itemize}
\item \OSC{write}: append the \OSC{arg} list formatted as a string to the textual content.
\end{itemize}

\example \\
\sample{/ITL/scene/text set txt "Hello";\\
/ITL/scene/text write "world!";
}


%===============================
%:  The debug nodes
\sublevel{The 'debug' nodes}
\label{debugnode}

Each component includes a static \OSC{debug} nodes provided to give information about components.

\index{Common messages!debug!map}
\index{Common messages!debug!name}

\begin{rail}
debugMsg : 'map' int32
		| ('name' int32) 
\end{rail}

\begin{itemize}
\item \OSC{map} is used to display the time to graphic mapping. The parameter is a int value: 0 prevents mapping display, 1 displays only the bounding boxes and 2 displays also the dates along with the boxes. Default is 0 (no map).
\item \OSC{name} is used to display both the object name and bounding box. The parameter is a boolean value. Default is 0.
\end{itemize}


%===============================
%:Application messages
\toplevel{Application messages}
\label{ITL}
Application messages are accepted by the static OSC address \OSC{/ITL}. 


%===============================
%:  Application management
\sublevel{Application management}
\label{applmgmt}

\index{ITL messages!rootPath}
\index{ITL messages!preprocess}
\index{ITL messages!mouse}
\index{ITL messages!defaultShow}
\index{ITL messages!load}
\index{ITL messages!read}
\index{ITL messages!hello}
\index{ITL messages!require}
\index{ITL messages!compatibility}
\index{ITL messages!rate}
\index{ITL messages!time}
\index{ITL messages!ticks}

\begin{rail}
ITLMsg : 'quit' 
		| ('rootPath' path) 
		| ('preprocess' file) 
		| ('mouse' ('show' | 'hide'))
		| ('defaultShow' int32)
		| ('load' filePath)
		| ('read' buffer)
		| ('require' float oscMsg)
		| ('compatibility' float)
		| ('time' int32)
		| ('ticks' int32)
		| ('rate' int32)
		| 'hello'
		| forwardingMsg
\end{rail}

\begin{itemize}
\item \OSC{quit}: requests the client application to quit.

\item \OSC{rootPath}: \emph{rootPath} of an INScore application is the default path where the application reads or writes a file when a relative path is used for this file. The default value is the user home directory. Sending the \OSC{rootPath} message without parameter resets the application path to its default value.

\item \OSC{preprocess}: evaluates the input file script and print the result to the log window.

\item \OSC{mouse}: hide or show the mouse pointer.

\item \OSC{defaultShow}: changes the default \OSC{show} status for new objects. \\
The default \OSC{defaultShow} value is 1.

\item \OSC{load}: loads a file previously saved using the \OSC{save} message (see section \fullref{common}). Note that the load operation appends the new objects to the existing scene. When necessary, it is the sender responsibility to clear the scene before loading a file. URL are supported for the file path (see section \fullref{filebasedrsrc});

\item \OSC{read}: read a buffer that is expected to contain a valid inscore script.

\item \OSC{require}: check that the current INScore version number is equal or greater to the number given as argument. The version number is given as a float value. A message is associated to the \OSC{require} message, which is triggered when the check fails. See section \fullref{interaction} for more details.

\item \OSC{compatibility}: preserve INScore previous behavior. The argument corresponds to a version number, INScore will preserve the corresponding behavior (objects scaling, default size, etc.).

\item \OSC{rate}: changes the time task rate. Note that null values are ignored.\\
The default \OSC{rate} value is 10.

\item \OSC{time}: sets the application current time. The time is expressed in milliseconds.

\item \OSC{ticks}: sets the application current ticks count. The ticks count indicates the number of time tasks performed by the application.

\item \OSC{hello}: query the host IP number. The message is intended for ITL applications discovery. Answer to the query has the following format: \\
\oldexample \OSC{IP  inPort outPort errPort} where \OSC{IP} is sent as a string and port numbers as integer values.

\item \OSC{forwardingMsg}: application support message forwading and filtering. See section \fullref{forwarding}.
\end{itemize}

\example \\
when sending the message:
\sample{/ITL hello;}
\sampleindent the application will answer with the following message:
\sample{/ITL 192.168.0.5  7000 7001 7003}
\sampleindent when it runs on a host which IP number is \OSC{192.168.0.5} using the default port numbers.

%===============================
%:  Ports management
\sublevel{Ports management}
\label{ITLPorts}

\index{ITL messages!port}
\index{ITL messages!outport}
\index{ITL messages!errport}

\begin{rail}
ITLPortsMsg : ('port' int32)
		| ('outport' int32)
		| ('errport' int32)
\end{rail}

Changes the UDP port numbers:
\begin{itemize}
\item \OSC{port} defines the listening port number, 
\item \OSC{outport} defines the port used to send replies to queries, 
\item \OSC{errport} defines the port used to send error messages. 
\end{itemize}
The \OSC{int32} parameter should be a positive value in the range \values{[1024-49150]}. \\
The default \OSC{port}, \OSC{outport} and \OSC{errport} values are 7000, 7001 and 7002.

\note{} \\
Error messages are sent as a single string.

%===============================
%:  System support
\sublevel{System support}
\label{system}

\index{ITL messages!browse}

\begin{rail}
ITLSystem : ('browse' file)
\end{rail}

\begin{itemize}
\item \OSC{browse} open the file given as parameter using the system default browser. The message supports URLs that can be of type \OSC{http://} , \OSC{https://} or \OSC{file://} . It supports also direct reference to a local file (e.g. myfile.html) that is translated into \OSC{file://} url using the application rootPath.
\end{itemize}



%===============================
%:  Application level queries
\sublevel{Application level queries}
\label{ITLQuery}

The application supports the \OSC{get} messages for its parameters (see section \fullref{getsect}). In addition, it provides the following messages to query version numbers.

\index{ITL messages!version}
\index{ITL messages!guido-version}
\index{ITL messages!musicxml-version}

\begin{rail}
ITLRequest : 'get'  ('version' | 'guido-version' | 'musicxml-version')
\end{rail}

\begin{itemize}
\item \OSC{version}: version number request.
\item \OSC{guido-version}: Guido engine version number request.
\item \OSC{musicxml-version}: MusicXML and Guido converter version numbers request. Returns "not available" when the library is not found.

\end{itemize}

\example \\
Querying INScore version:
\sample{/ITL get version;}
\sampleindent will give the following as output:
\sample{/ITL version 1.00}

%===============================
%:  Application static nodes
\sublevel{Application static nodes}
\label{ITLStatic}

The application level provides the static nodes - \OSC{stats}, \OSC{debug} and \OSC{log}, available at \OSC{/ITL/stats} \OSC{/ITL/debug} and \OSC{/ITL/log}  to help debugging communication and INScore scripts design.

\subsublevel{The 'stats' nodes}
\label{ITLstat}

\index{ITL stat!get}
\index{ITL stat!reset}

\begin{rail}
ITLStats : 'get'  | 'reset'
\end{rail}

\begin{itemize}
\item \OSC{get} gives the count of handled messages at OSC and UDP levels: the UDP count indicates the count of messages received from the network, the OSC count includes the UDP count and the messages received internally.
\item \OSC{reset} resets the counters to zero. Note that querying the \OSC{stats} node increments at least the OSC the counter.
\end{itemize}

\example \\
Answer to a \OSC{get} message addressed to \OSC{/ITL/stats}
\sample{/ITL/stats osc 15 udp 10}


\subsublevel{The 'debug' nodes}
\label{ITLdebug}

The \OSC{debug} node is used to activate debugging information.

\index{ITL debug!osc}

\begin{rail}
ITLdebug : 'osc' int23
\end{rail}

\begin{itemize}
\item switch the debug mode ON or OFF. The parameter is interpreted as a boolean value. When in debug mode, INScore sends verbose messages to the OSC error port for every message that can't be correctly handled. Debugging is ON by default.
\end{itemize}

\example \\
Error messages generated on error port in debug mode:
\sample{error:  incorrect OSC address: /ITL/stat\\
error:  incorrect parameters: /ITL/scene/foo unknown 0.1\\
error:  incorrect parameters: /ITL/scene/foo x "incorrectType"
}


\subsublevel{The 'log' nodes}
\label{ITLlog}

The \OSC{log} node controls a console window that display all the messages sent to the OSC error port. Typical content is given by the example above.

\index{ITL log!show}
\index{ITL log!clear}
\index{ITL log!wrap}
\index{ITL log!save}
\index{ITL log!level}

\begin{rail}
ITLLog : 'show'  int32
		| 'clear'
		| 'foreground'
		| 'wrap' int32
		| 'write' (arg +)
		| 'save' string
		| 'level' int32
\end{rail}

\begin{itemize}
\item \OSC{show} show or hides the console. The parameter is a boolean value.
\item \OSC{clear} clear the console window.
\item \OSC{foreground} put the console window to front.
\item \OSC{wrap} control line wrapping of the console. The parameter is a boolean value.
\item \OSC{write} write the \OSC{arg} list formatted as a string to the log window.
\item \OSC{save} save the current log content to a file. The parameter is a file name. When expressed as a relative path, the file is saved under the current application root path.
\item \OSC{level} set the log level. Expected values are: 
\begin{itemize}
\item 0 : no log
\item 1 : log errors (default value)
\item 2 : log errors and output of \OSC{get} messages
\end{itemize}
\end{itemize}



\subsublevel{The 'plugins' nodes}
\label{ITLplugins}

The \OSC{plugins} node controls the search path for plugins. See section \fullref{plugins} for more information on plugins and search strategies.

\index{ITL plugin!path}
\index{ITL plugin!reset}

\begin{rail}
ITLPlugin : 'path'  folder
		| 'reset'
\end{rail}

\begin{itemize}
\item \OSC{path} add \OSC{folder} as a user path. The system will look for plugins in this folder first.
\item \OSC{reset} clear the current user path.
\end{itemize}


%===============================
%:Scene messages
\toplevel{Scene messages}
\label{scene}
A scene may be viewed as a window on the score elements. Its address is \OSC{/ITL/\textit{sceneIdentifier}} where \OSC{\textit{sceneIdentifier}} is the scene name. 

%===============================
%:  Scene control
\sublevel{Scene control}
\label{scenecontrol}

The following messages are available at scene level, to control the scene appearance and behaviour:

\index{Scene messages}
\index{Scene messages!new}
\index{Scene messages!del}
\index{Scene messages!foreground}
\index{Scene messages!rootPath}
\index{Scene messages!preprocess}
\index{Scene messages!load}
\index{Scene messages!reset}
\index{Scene messages!fullscreen}
\index{Scene messages!frameless}
\index{Scene messages!absolutexy}

\begin{rail}
sceneMsg :  'new'
			| 'del'
			| 'reset'
			| 'foreground'
			| ('rootPath' ( path | )) 
			| ('preprocess' file) 
			| ('load' filePath)
			| ('fullscreen' int32)
			| ('frameless' int32)
			| ('absolutexy' int32)
			| ('windowOpacity' int32)
			| commonMsg
			| forwardingMsg
\end{rail}

\begin{itemize}
\item \OSC{new}: creates a new scene and opens it in a new window.
\item \OSC{del}: deletes a scene and closes the corresponding window.
\item \OSC{reset}: clears the scene (i.e. delete all components) and resets the scene to its default state (position, size and color).
\item \OSC{foreground}: display scene window in foreground of all other windows in the system windows manager.
\item \OSC{rootPath}: \emph{rootPath} of a scene is the default path where the scene reads or writes a file when a relative path is used for this file. When no value has been specified, the application  \emph{rootPath} is used. Calling \OSC{rootPath} without argument clears the scene \emph{rootPath}.
\item \OSC{preprocess}: evaluates the input file script and print the result to the log window.
\item \OSC{load}: loads an INScore file to the scene. Note that the OSC addresses are translated to the scene OSC address.
%\item \OSC{foreground}: put the scene to foreground.
\item \OSC{fullscreen}: requests the scene to switch to full screen or normal screen.  The parameter is interpreted as a boolean value. Default value is \values{0}.
\item \OSC{frameless}: requests the scene to switch to frameless or normal window.  The parameter is interpreted as a boolean value. Default value is \values{0}.
\item \OSC{absolutexy}: requests the scene to absolute or relative coordinates. Absolute coordinates are in pixels relative to the top left corner of the screen. Relative coordinates are in the range [-1, 1] where [0,0] is the center of the screen. The message parameter is interpreted as a boolean value. Default value is \values{0}.
\item \OSC{windowOpacity}: switch the scene window to opaque or transparent mode. When in transparent mode, the scene alpha channel controls the window opacity (from completely opaque to completely transparent). In opaque mode, the scene alpha channel controls the background brush only. Default value is \values{0} (transparent).
\item \OSC{commonMsg}: a scene support the common graphic attributes. See section \fullref{common}.
\item \OSC{forwardingMsg}: a scene support message forwading and filtering. See section \fullref{forwarding}.
\end{itemize}

\example \\
Setting a scene current path:
\sample{/ITL/scene rootPath "/path/to/my/folder";}
Loading an INScore file:
\sample{/ITL/scene load "myscript.inscore";}
\sampleindent will load \OSC{/path/to/my/folder/myscript.inscore} into the scene. 

Setting a scene to fullscreen:
\sample{/ITL/scene fullscreen 1;}
Creating a new score named \OSC{myScore}:
\sample{/ITL/myScore new;}

%===============================
%:  OpenGl rendering
\sublevel{OpenGl rendering}
\label{opengl}
A scene supports optional OpenGl rendering.

\index{Scene messages!opengl}

\begin{rail}
openglMsg :  'opengl' int32
\end{rail}

\begin{itemize}
\item \OSC{opengl}: requests the scene to switch to OpenGl or normal rendering.  The parameter is interpreted as a boolean value. Default value is \values{0}. 
\end{itemize}

\note \\
OpenGl rendering improves significantly the performance of graphic operations but at the cost of dirty rendering for text and scores.

%===============================
%:  Scene queries
\sublevel{Scene queries}
\label{scenequery}

A scene may respond to queries regarding its elements:

\index{Scene query}
\index{Scene query!count}
\index{Scene query!rcount}

\begin{rail}
sceneQuery : 'get' ( 'count'
					| 'rcount')
\end{rail}

\begin{itemize}
\item \OSC{count}: count the number of elements in the scene.
\item \OSC{rcount}: recursively count the number of elements in the scene.
\end{itemize}

\example \\
Counting the elements in a scene:
\sample{/ITL/scene get count;\\
\hspace*{5mm}will give a message like the following as output: \\
/ITL/scene count 200;
}

%===============================
%:Forwarding
\toplevel{Messages forwarding}
\label{forwarding}
The messages handled by the application or by a scene can be forwarded to arbitrary remote hosts. A filtering mecanism can be used to have a fine control of forwarded messages.

%===============================
%:  Messages forwarding
\sublevel{Remote hosts list}
\label{ITLForward}

Remote hosts lists can be set using the \OSC{forward} message at scene or application level. Hosts lists of the application and of each scene are independent.
At scene level, only messages handle by the scene are forwarded (ie message for the scene itself or for one of his children object).
The \OSC{forward} message itself can't be forwarded. 
A message from a host cannot be forwarded to him to avoid direct loop.
 
\index{ITL messages!forward}

\begin{rail}
ITLMsgForward : ('forward' ( [1] | [2] hostname +))
\end{rail}

\begin{itemize}
\item 1) removes the set of forwarded destinations,
\item 2) set a list of remote hosts for forwarding. Note that \OSC{hostname} can be any legal host name or IP number, optionally extended with a port number separated by a semi-colon. By default, when no port number is specified, the default application listening port number is used (7000).
\end{itemize}
\example\\
Forwarding messages handle by application to \OSC{host1.adomain.org} using the default application listening port number (7000)
and to \OSC{host2.adomain.org} on port number 5100.

\sample{/ITL forward host1.adomain.org host2.adomain.org:5100;}


Forwarding messages handle by the scene \OSC{scene1} to \OSC{host3.adomain.org} using the default application listening port number (7000)
and to \OSC{host4.adomain.org} on port number 5100.

\sample{/ITL/scene1 forward host1.adomain.org host2.adomain.org:5100;}

%===============================
%:  Filters
\sublevel{Filters}
\label{ITLFilteringForward}

The messages forwarded to arbitrary remote hosts using the \OSC{forward} message can be filtered to send only wanted messages. The static \OSC{filter} node is use manage the filter. A static \OSC{filter} node is created for each scene and one at application level. The filter can be construct with OSC address and messages. 
 
\index{ITL messages!accept}
\index{ITL messages!reject}

\begin{rail}
ITLFilteringForward : [1] ('accept' (|item +)) | [2] ('reject' (|item +))
\end{rail}

\begin{itemize}
\item 1) Remplace the actual accepted list by the new list or by an empty list. Item in accepted list are not filtered by the reject item list.
\item 2) Remplace the actual accepted list by the new list or by an empty list. Item in reject list are filtered if they not match the accept list.
\end{itemize}

When a new message is incoming, if they match to an accepted item, filter is not apply.\\ \\
\example\\
Filter at application level :
\sample{/ITL/filter reject /ITL/scene/line* /ITL/scene/rect; \\
/ITL/filter accept /ITL/scene/line2 scale arrows;
}
Message with OSC message with address starting with \OSC{/ITL/scene/line} or with address \OSC{/ITL/scene/rect} are filtered only if message address is not \OSC{/ITL/scene/line2} or if the content is not \OSC{scale} or \OSC{arrows}.\\
\\
Filter at scene level :
\sample{/ITL/scene1/filter reject fontWeight /ITL/scene1/rect;
}
The \OSC{fontWeight} message and message for \OSC{/ITL/scene1/rect} are rejected.


%===============================
%:Layers
\toplevel{Layers}
\label{layers}

Layers may be viewed as containers or as groups. They represent a way to structure both the address space and the graphic space. 

From graphic viewpoint, a layer is a scene inside a scene. All the properties of 'rect' components are available to layers: position, scale, color, transparency, etc.). By default, a layer is not visible: it has no brush and no pen, but changing the brush style (see section \fullref{brush}) - e.g. to \OSC{solid} - makes it visible.

From time viewpoint, a layer has the common time attributes i.e. a date, a duration.

A layer may be synchronized to other objects, including other layers. It includes a \OSC{sync} node and supports synhcronization of the enclosed objects. However, synchronization is restricted to objects from the same layer and cannot cross the border of a layer. 


\example \\
Creating a layer and its content:
\sample{/ITL/scene/layer1 set layer;\\
/ITL/scene/layer1/score set gmnf 'myscore.gmn';\\
/ITL/scene/layer1/cursor set rect 0.01 0.1;
}

Synchronizing 2 components of a layer :
\sample{\icomment'score' and 'cursor' must be enclosed in layer1 \\
/ITL/scene/layer1/sync cursor score; 
}

Making a layer visible :
\sample{/ITL/scene/layer1 brushStyle solid; \\
/ITL/scene/layer1 color 120 120 120; 
}

%===============================
%:	Layers generalization
\sublevel{Layers generalization}
\label{layersgen}

The idea of layer is generalized to all the type of objects: any INScore object can be a container without depth limitation. 

Layers but also any object respond to the \OSC{count} and \OSC{rcount} queries described in section \fullref{scenequery}.

%===============================
%:Mapping graphic space to time space
\toplevel{Mapping graphic space to time space}
\label{mapping}

Time to space mapping refers to the description of relationship between an object local graphic space and its time space. A mapping consists in a set of relations between the two spaces. INScore provides specific messages to describes mappings and to synchronize arbitrary objects i.e. to display their time relationships in the graphic space.

%===============================
%:    The 'map' message
\sublevel{The 'map' message}
\label{mapMsg}

The \OSC{map} messages can be sent to any address with the form \OSC{/ITL/\textit{scene}/\textit{identifier}}. It is intended to describe the target object relation to time and sets a relation between an object segmentation and a time segmentation. 
The global form of the message is:

\index{Common messages!map}

\begin{rail}
mapMsg : 'map' ( | mapName ) (relation	|	( del ))
\end{rail}

The \OSC{relation} parameter must be sent as a single string which format is described below. It consists in a list of associations between the object local space and its time space expressed as segments.

\begin{rail}
relation : 
		([1] float2DSegment timeSegment ) +
	| 	([2] int2DSegment timeSegment ) +
	| 	([3] int1DSegment timeSegment ) + 
\end{rail}

Segments are expressed as a list of intervals. For a 1 dimension resource, a segment is a made of a single interval. For a 2 dimensions resource, a segment is a made of 2 intervals: an interval on the \values{x}-axis and one on the \values{y}-axis for graphic based resource, or an interval on columns and one on lines for text based resources. Intervals are right-opened.

The different kind of relations corresponds to:
\begin{itemize}
\item \textbf{[1]} a relation between a 2 dimensions segmentation expressed in float values and a relative time segmentation. These segmentations are used by \OSC{rect, ellipse, polygon, curve, line} components.
\item \textbf{[2]} a relation between a 2 dimensions segmentation expressed in integer values and a relative time segmentation. These segmentations are used by \OSC{txt, txtf, img} components. 
\item \textbf{[3]} a relation between a 1 dimension segmentation expressed in integer values and a relative time segmentation. These segmentations are used by the \OSC{graph} component and express a relation between a signal space and time.
\end{itemize}
Table \ref{maptable} summarizes the specific local segmentation used by each component type. 

The specified \OSC{map} can be named with an optional \OSC{mapName} string; this name can be further reused, during object synchronization, to specify the mapping to use. When \OSC{mapName} is not specified, the mapping has a default \emph{empty name}.

The \OSC{del} command deletes the mapping specified with \OSC{mapName}, or the \emph{'empty name'} mapping if no map name is specified.


\begin{table}[htbp]
\caption{Local segmentation type for each component}
\begin{center}
\begin{tabular}{|r|l|}
\hline
component type & segmentation type \\
\hline
\OSC{txt, txtf}		& int2DSegments \\
\OSC{img}			& int2DSegments \\
%\OSC{rect, ellipse, polygon, curve, line, video}	&  \textbf{vectorial2relativeTime} \\
\OSC{rect, ellipse, polygon, curve}	&  float2DSegments \\
\OSC{graph}			&  int1DSegments \\
\hline
\end{tabular}
\end{center}
\label{maptable}
\end{table}


%===============================
\subsublevel{Segments definitions}
\label{segdefs}

\begin{rail}
timeSegment : relativeTimeSegment | absoluteTimeSegment
\end{rail}

\begin{rail}
relativeTimeSegment : '(' relativeTimeInterval ')' 
\end{rail}
\begin{rail}
absoluteTimeSegment : '(' absoluteTimeInterval ')' 
\end{rail}

\begin{rail}
float2DSegment : '(' floatInterval floatInterval ')' 
\end{rail}
\begin{rail}
int2DSegment : '(' intInterval intInterval ')' 
\end{rail}
\begin{rail}
int1DSegment : '(' intInterval ')' 
\end{rail}


\begin{rail}
relativeTimeInterval : '[' rational ',' rational '[' 
\end{rail}
\begin{rail}
absoluteTimeInterval : '[' absoluteTime ',' absoluteTime '[' 
\end{rail}
\begin{rail}
floatInterval : '[' float32 ',' float32 '['
\end{rail}
\begin{rail}
intInterval : '[' int32 ',' int32 '['
\end{rail}

Relative time is expressed as \OSC{rational} values where \values{1} represents a whole note.

\begin{rail}
rational : int32 '/' int32
\end{rail}

Absolute time is expressed in minutes, seconds and cents. It is automatically converted to relative time, assuming that the 
tempo is 60 quarter notes per minute.
\begin{rail}
absoluteTime : "min" ":" "sec" ":" "cents"
\end{rail}

\example \\
Mapping an image graphic space to time:
\sample{/ITL/scene/myImage map \\
\hspace*{1cm}"( [0, 67[    [0, 86[ ) ( [0/2, 1/2[ ) \\
\hspace*{1.15cm}( [67, 113[  [0, 86[ ) ( [1/2, 1/1[ ) \\
\hspace*{1.15cm}( [113, 153[ [0, 86[ ) ( [1/1, 3/2[ ) \\
\hspace*{1.15cm}( [153, 190[ [0, 86[ ) ( [3/2, 2/1[ ) \\
\hspace*{1.15cm}( [190, 235[ [0, 86[ ) ( [2/1, 5/2[ )" ;
}
the image is horizontally segmented into 5 different graphic segments that express pixel positions. The vertical dimension of the segments remains the same and corresponds to the interval \values{[0, 86[}. Each graphic segment is associated to a time interval which duration is 1/2 (a half note).

The same mapping using absolute time assumes that 1 second is equal to 1 quarter note:
\sample{/ITL/scene/myImage map \\
\hspace*{1cm}"( [0, 67[    [0, 86[ )   ( [0:0:0, 0:2:0[ ) \\
\hspace*{1.15cm}( [67, 113[  [0, 86[ ) ( [0:2:0, 0:4:0[ ) \\
\hspace*{1.15cm}( [113, 153[ [0, 86[ ) ( [0:4:0, 0:6:0[ ) \\
\hspace*{1.15cm}( [153, 190[ [0, 86[ ) ( [0:6:0, 0:8:0[ ) \\
\hspace*{1.15cm}( [190, 235[ [0, 86[ ) ( [0:8:0, 0:10:0[ )" ;
}


\note{about local spaces}
\begin{itemize}
\item Text objects (\OSC{txt txtf}) local space is expressed by intervals on columns and rows.
\item Html object (\OSC{html, htmlf}) do not support mapping because there is not correspondence between the text and the graphic space.
\item Vectorial objects (\OSC{rect, ellipse, polygon, curve, svg,...}) express their local graphic space in internal coordinates system i.e. on the [-1.,1.] interval.
\item Bitmap objects (\OSC{img}) express their local graphic space in pixels.
\end{itemize}


%===============================
%:    The 'map+' message
\sublevel{The 'map+' message}
\label{mapAddMsg}
The \OSC{map+} messages is similar to the \OSC{map} message but doesn't replace the existing mapping data: the specified relations are added to the existing one.

\index{Common messages!map+}

\begin{rail}
mapAddMsg : 'map+' ( | mapName ) relation
\end{rail}

%===============================
%:    Mapping files
\sublevel{Mapping files}
\label{mapFileMsg}
The \OSC{mapf} messages is similar to the \OSC{map} message but gives the path name of a file containing the mapping data, along with the optional map name.

\index{Common messages!mapf}

\begin{rail}
mapfMsg : 'mapf' ( | mapName ) mapFilePath
\end{rail}


%===============================
%:    Symbolic score mappings
\sublevel{Symbolic score mappings}
\label{guidomap}

Mapping between the graphic and time space is automatically computed for symbolic score \OSC{gmn, gmnstream, gmnf}. However and depending on the application, the graphic space may be segmented in different ways, for instance: different graphic segments for different staves, a single graphic segment traversing all a system, etc. Thus for a symbolic score, the \OSC{map} message different and is only intended to select one king mapping supported by the system.

\index{Synchronization!Guido map}
\index{Synchronization!Guido map!page}
\index{Synchronization!Guido map!system}
\index{Synchronization!Guido map!systemflat}
\index{Synchronization!Guido map!staff}
\index{Synchronization!Guido map!voice}

\begin{rail}
scoreMap : 'map' ('page' | 'system' | 'systemflat' | 'staffn' | 'voicen' )
\end{rail}

\begin{itemize}
\item \OSC{page}: a page level mapping
\item \OSC{system}: a system level mapping
\item \OSC{systemflat}: a system level mapping without system subdivision (one graphic segment per system)
\item \OSC{staff\textit{n}}: a staff level mapping: the staff number is indicated by \OSC{n}, a number between 1 and the score staves count.
\item \OSC{voice\textit{n}}: a voice level mapping: the voice number is indicated by \OSC{n}, a number between 1 and the score voices count.
\end{itemize}

The default mapping for a symbolic score is unnamed but equivalent to \OSC{staff1}.

\example \\
Requesting the mapping of the third staff of a score:
\sample{/ITL/scene/myScore map staff3;}
Requesting the system mapping :
\sample{/ITL/scene/myScore map system;}

\note{} \\
A voice may be distributed on several staves and thus a staff may contain several voices.


%-------------------------------
%:Synchronization
\toplevel{Synchronization}
\label{syncmsg}

Synchronization between components is in charge of the static \OSC{sync} node, automatically embedded in each object. Its address is \OSC{/ITL/.../\textit{object}/sync} and it supports messages to add or remove a master / slave relation between components or to query the synchronizations state.

\note{} \\
A master can naturally have several slaves, but a slave can have several masters as well. In this case, it will be drawn several times, corresponding to each master's space.

\index{Synchronization}
\index{Synchronization!get}

\begin{rail}
sync : syncIdentifier 
	 ( [1] syncIdentifier (| syncmode +) 
	   | [2] syncIdentifier 'del'
	   | [3] )
	   | [4] 'get' ( | target)
\end{rail}

\begin{itemize}
\item \textbf{[1]} the \OSC{slave} \OSC{master} form is followed by an optional synchronization mode (see below). It adds a slave / master relation between the first and the second component.
\item \textbf{[2]} the \OSC{slave} \OSC{master} \OSC{del} form removes the specified slave/master relation.
\item \textbf{[3]} the \OSC{slave} form without \OSC{master} removes all synchronizations with the slave.
\item \textbf{[4]} the \OSC{get} message is intended to query the synchronization state. The optional parameter is the identifier of a component. The \OSC{get} message without parameter is equivalent to a \OSC{get} message addressed to each object declared in the \OSC{sync} node.
\end{itemize}

\index{Synchronization! syncIdentifier}

\begin{rail}
syncIdentifier : [1] identifier 
		| [2] identifier ':' mapName
\end{rail}

Synchronization identifiers indicates 1) the name of an object or 2) the name of an object associated to a mapping name. Using the first form (i.e. without explicit mapping name), the system uses the default unnamed mapping (see section \fullref{mapMsg} mappings and named mappings).

Synchronization between components has no effect if any of the required mapping is missing (see table \ref{maptable}).

\example \\
Synchronizing an object on several masters:
\sample{/ITL/scene/myParent/sync mySlave myMaster1;\\
/ITL/scene/myParent/sync mySlave myMaster2;
}

Synchronizing two objects using a specific mapping (the second object is assumed to be a symbolic score (\OSC{gmn}, \OSC{gmnstream} or \OSC{gmnf}) which \OSC{system} mapping has been previously requested):
\sample{/ITL/scene/myParent/sync mySlave myMaster:system;}

%-------------------------------
%:    Synchronization modes
\sublevel{Synchronization modes}
\label{syncmode}

Synchronizing a slave component \values{A} to a master component \values{B} has the following effect:
\begin{itemize}
\item \values{A} position (x) is modified to match the \values{B} time position corresponding to \values{A} date.
\item depending on the optional \OSC{syncStretch} option, \values{A} width and/or height is modified to match the  corresponding \values{B} dimension (see below).
\item depending on the optional \OSC{syncPos} option, \values{A} vertical position (y) is modified. Note that the \OSC{y} position remains free and could always be modified using a \OSC{dy} message.
\item if \values{A} date has no graphic correspondence in \values{B} mapping (the date is not mapped, or out of \values{B} mapping bounds ), \values{A} won't be visible.
\end{itemize}

\index{Synchronization!syncmode}

\begin{rail}
syncmode : syncHow| syncStretch | syncPos | mapName
\end{rail}

\subsublevel{Using the master date}
\label{syncmaster}

\index{Synchronization!syncHow}
\index{Synchronization!syncHow!relative}
\index{Synchronization!syncHow!absolute}

\begin{rail}
syncHow : 'relative' | 'absolute'
\end{rail}

The synchronization mode makes use of the master time to graphic mapping to compute the slave position. It may also use the master current date, depending on the following options:
\begin{itemize}
\item \OSC{relative}: the time position where the slave appears is relative to the mapping and to the master current date (actually, it shifts the mapping from the master current date). The relative mode is used by default.
\item \OSC{absolute}: the time position where the slave appears corresponds to the mapping date only.
\end{itemize}

\note{} \\
Use of the \OSC{absolute} mode may take sense with nested synchronizations: let's consider an object \values{A}, slave of \values{B}, which is slave of \values{C}.
In \OSC{relative} mode and if \values{A} and \values{B} receive the same \OSC{clock} messages, \values{A} will remain at a fixed position on \values{B} although it is moving in time.

\example \\
Describing nested synchronizations, the first one using the \OSC{absolute} mode:
\sample{/ITL/scene/sync slave masterSlave absolute ;\\
/ITL/scene/sync masterSlave master ;
}

\subsublevel{Synchronizing an object duration}
\label{syncduration}

\index{Synchronization!syncStretch}
\index{Synchronization!syncStretch!h}
\index{Synchronization!syncStretch!v}
\index{Synchronization!syncStretch!hv}

\begin{rail}
syncStretch : 'h' | 'v' | 'hv'
\end{rail}

The synchronization stretch mode has the following effect on the slave dimensions:
\begin{itemize}
\item \OSC{h}: the slave is horizontally stretched to align its begin and end dates to the corresponding master locations.
\item \OSC{v}: the slave is vertically stretched to the master map vertical dimension.
\item \OSC{hv}: combines the above parameters.
\end{itemize}
By default, no stretching is applied.

\example \\
Synchronizing two objects, aligning the slave duration to the corresponding master space and stretching the slave to the master map vertical dimension:
\sample{/ITL/scene/sync mySlave myMaster hv ;}


\subsublevel{Controlling the slave position}
\label{syncPos}

\index{Synchronization!syncPos}
\index{Synchronization!syncPos!syncOver}
\index{Synchronization!syncPos!syncTop}
\index{Synchronization!syncPos!syncBottom}
\index{Synchronization!syncPos!syncFrame}

\begin{rail}
syncPos : 'syncOver' | 'syncTop' | 'syncBottom' | 'syncFrame'
\end{rail}

The synchronization position mode has the following effects on the slave \values{y} position:
\begin{itemize}
\item \OSC{syncOver}: the center of the slave is aligned to the master center.
\item \OSC{syncTop}: the bottom of the slave is aligned to the top of the master.
\item \OSC{syncBottom}: the top of the slave is aligned to the bottom of the master.
\item \OSC{syncFrame}: used to browse the master frame (see the next section).
\end{itemize}
The default position mode is \OSC{syncOver}. The \OSC{y} attribute of the slave remains available to displacement (\OSC{dy}). 

\note{} \\
The \values{y} position of a synchronized object remains a free attribute. To control this position, you should send \OSC{dy} messages.  

\example \\
Synchronizing two objects, aligning the slave duration to the corresponding master space, the slave being below the master map:
\sample{/ITL/scene/sync mySlave myMaster h syncBottom;}


\subsublevel{The syncFrame mode}
\label{syncFrame}

When the \OSC{syncFrame} mode is used, the slave is placed on the frame of the master. Typically, this frame corresponds to the object bounding box that is also the object default mapping. For ellipses, arcs, lines, polygons, the frame corresponds to the border of the object. The frame duration is the object duration.  

Mappings and stretch options are ignored in  \OSC{syncFrame} mode.


%===============================
%:Signals and graphic signals
\toplevel{Signals and graphic signals}
\label{graphsig}

The graphic representation of a signal is approached with \emph{graphic signals}. As illustrated in figure \ref{graphimg}, the graphic representation of a signal could be viewed as a stream of a limited set of parameters : the \values{y} coordinate at a time \values{t}, a thickness \values{h} and a color \values{c}. 
A \emph{graphic signal} is a composite signal including a set of 3 parallel signals that control these parameters. Thus the INScore library provides messages to create signals and to combine them into \emph{graphic signals}. 

\begin{figure}[h]
	\centering \includegraphics[width=90mm]{imgs/graph}
 \caption{A simple graphic signal, defined at time t by a coordinate y, a thickness h and a color c}
 \label{graphimg}
\end{figure}

%-------------------------------
%:    The signal static node.
\sublevel{The 'signal' static node.}
\label{signode}
A \OSC{scene} includes a static signal node, which OSC address is \OSC{/ITL/\textit{scene}/signal} which may be viewed as a container for signals. It is also used for \textit{composing signals in parallel}.

The \OSC{signal} node supports the \OSC{get} message that gives the list of the defined signals and also the \OSC{get connect} message that gives a list of all connections, but doesn't take any argument.

\example \\
Querying the signal node:
\sample{/ITL/scene/signal get;}
\sampleindent will give the enclosed signals definitions:
\sample{/ITL/scene/signal/y size 200 ;\\
/ITL/scene/signal/h size 200 ;
}

And :
\sample{/ITL/scene/signal get connect;}
\sampleindent will give the signal connections :
\sample{/ITL/scene/signal connect cos object1:method1 ;\\
/ITL/scene/signal connect sin object2:method2 ;
}


\subsublevel{Signal messages.}
\label{ssignal}
Signal messages can be sent to any address with the form \OSC{/ITL/\textit{scene}/signal/\textit{identifier}}, where \OSC{\textit{identifier}} is a unique signal identifier.
The set of messages supported by a signal is the following:

\index{Signal}
\index{Signal!simple signal!size}
\index{Signal!simple signal!default}
\index{Signal!simple signal!get}
\index{Signal!simple signal!reset}
\index{Signal!simple signal!del}

\begin{rail}
simpleSignal : [1] ( float32 + )
		| [2] ('size' int32) 
		| [3] ('default' float32)
		| [4] 'get' ( | 'size' | 'default')
		| [5] 'reset'
		| [6] 'del'
\end{rail}

\begin{itemize}
\item \textbf{[1]} push an arbitrary data count into the signal buffer. The expected data range is \values{[-1,1]}. Note that the internal data buffer is a ring buffer, thus data are wrapped when the data count if greater than the buffer size. 
\item \textbf{[2]} the \OSC{size} message sets the signal buffer size. When not specified, the buffer size value is the size of the first data message. 
\item \textbf{[3]} the \OSC{default} message sets the \emph{default signal value}. A signal \emph{default value} is the value returned when a query asks for data past the available values.
\item \textbf{[4]} the \OSC{get} message without parameter gives the signal current values. The \OSC{size} and  \OSC{default} parameters are used to query the signal size and default values.
\item \textbf{[5]} the \OSC{reset} message clears the signal data. 
\item \textbf{[6]} the \OSC{del} message deletes the signal from the \OSC{signal} space. Note that it is safe to delete a signal even when used by a graphic signal. 
\end{itemize}

\example \\
Creating a signal with a given buffer size:
\sample{/ITL/scene/signal/mySig size 200;}
Creating a signal with a given set of data (the buffer size will be the data size):
\sample{/ITL/scene/signal/mySig 0.\ 0.1\ 0.2\ 0.3\ 0.4\ 0.5\ 0.4\ 0.3\ 0.2\ 0.1\ 0.\ -0.1\ -0.2 ;}


%-------------------------------
%:    Composing signals in parallel.
\subsublevel{Composing signals in parallel.}
\label{parcomp}
Composing signals in parallel produces a signal which value at a time \values{t} is a vector of the composed signals values. Thus an additional read-only attribute is defined on \emph{parallel signals} : the signal \emph{dimension} which is size of the signals vector. Note that the dimension property holds also for simple signals.

The format of the messages for parallel signals is the following:

\index{Signal!parallel signal}
\index{Signal!parallel signal!get}

\begin{rail}
parallelSignal :  
		  [1] 'set' ( signal + )
		| [2] (| projectionString) ( float32 + )
		| [3] ('get' 'dimension') 
\end{rail}

where 
\begin{rail}
signal :  
		  [4] identifier
		| [5] float32
\end{rail}

\begin{itemize}
\item \textbf{[1]} defines a new signal composed of the signals given as parameters. A signal parameter is defined as:

\begin{itemize}
\item \textbf{[4]} an \OSC{identifier} i.e. a signal name referring to an existing signal in the \OSC{signal} node. 
\item \textbf{[5]} or as a float value. This form is equivalent to an anonymous constant signal holding the given value. 
\end{itemize}

\item \textbf{[2]} sets the values of the signals using a projection string. See section \fullref{sigproj}. 
\item \textbf{[3]} in addition to the \OSC{get} format defined for signals, a parallel signal supports the \OSC{get dimension} message, that gives the number of simple signals in parallel. The dimension of a simple signal is 1. 
\end{itemize}

\example \\
Putting a signal \OSC{y} and constant signals 0.01 0. 1. 1. 1. in parallel:
\sample{/ITL/scene/signal/mySig set y 0.01 0. 1. 1. 1. ;}
Querying the previously defined parallel signal:
\sample{/ITL/scene/signal/mySig get ;\\
will give the following output: \\
/ITL/scene/signal/mySig set y 0.01 0. 1. 1. 1.
}

\note{} \\
For a parallel signal:
\begin{itemize}
\item the \OSC{get size} message gives the maximum of the components size. 
\item the \OSC{get default} message gives the default value of the first signal. 
\end{itemize}

%-------------------------------
%:    Distributing data to signals in parallel
\subsublevel{Distributing data to signals in parallel}
\label{sigproj}

When signals are in parallel, a \emph{projection string} may be used to distribute data over each signal.
Individual components of a parallel signal may be addressed using a \emph{projection string} that is defined as follows:

\index{Signal!parallel signal!projection string}

\begin{rail}
projectionString :  '[' int32 (| '\~{}' (| int32)) ']'
\end{rail}

The projection string is made of a \emph{index value}, followed by an optional \emph{parallel marker} (\OSC{\~{}}), followed by an optional \emph{step value}, all enclosed in brackets.

The \emph{index value} \values{n} is the index of a target signal. When the \emph{parallel marker} option is not present, the values are directed to the target signal. Indexes start at 0.

\example \\
Sending data to the second component of a parallel signal:
\sample{/ITL/scene/signal/sig '[1]' 0.\ 0.1\ 0.2\ 0.3\ 0.4\ 0.5\ 0.4\ 0.3\ 0.2\ 0.1\ 0. ;}
\sampleindent is equivalent to the following message (assuming that the second signal name is 's2'):
\sample{/ITL/scene/signal/s2 0.\ 0.1\ 0.2\ 0.3\ 0.4\ 0.5\ 0.4\ 0.3\ 0.2\ 0.1\ 0. ;}

Note that:
\begin{itemize}
\item the message is ignored when \values{n} is greater than the number of signals in parallel. Default \values{n} value is \values{0}. 
\item setting directly the values of a simple signal or as the projection of a parallel signal are equivalent.
\end{itemize}

The \emph{parallel marker} (\OSC{\~{}}) and the \emph{step value} \values{w} options affect the target signals. Let's consider \values{s[n]} as the signal at index \values{n}. The values are distributed in sequence and in loop to the signals \values{s[n], s[n+w]...s[m]} where \values{m} is the greatest value of the index \values{n+(w.i)} that is less than the signal dimension. The default  \emph{step value} is \values{1}.

\example \\
Sending data to the second and third components of a set of 3 parallel signals:
\sample{/ITL/scene/signal/sig [1\~{}] 0.1 0.2 ;}
\sampleindent is equivalent to the following messages (assuming that the signal dimension is 3):
\sample{/ITL/scene/signal/sig [1] 0.1 ;\\
/ITL/scene/signal/sig [2] 0.2 ;
}
\sampleindent or to the following (assuming that the target signal names are 's2' and 's3'):
\sample{/ITL/scene/signal/s2 0.1;\\
/ITL/scene/signal/s3 0.2;
}


%---------------------------------
%: signal connections
\sublevel{Connecting signals to graphic attributes.}
\label{signalcnx}

A signal may be connected to one or several graphic attributes of an object. Only the common attributes  (see section \fullref{common}) support this mechanism.
When a connection between a signal and an object attribute is set, sending values to the signal is equivalent to send the values to the connected object attribute. A similar behavior could be achieved by sending the equivalent messages, however the connection mechanism is provided for efficiency reasons and in addition, it supports values scaling. 

\index{Signal!connect}
\index{Signal!disconnect}

\begin{rail}
signalcnx : 	( 'connect'   connection )
			| 	'disconnect' ( [1] connection | [2] signal | [3]  signal object )
\end{rail}

\begin{itemize}
\item the \OSC{connect} message makes a connection between a signal and one or several attributes of one or several objects.
\item the \OSC{disconnect} message breaks a specific connection \textbf{[1]} or all the connections of a given signal \textbf{[2]}, or all connections between a given signal and a given object \textbf{[3]}.
\end{itemize}

\index{Signal!connection}

\begin{rail}
connection : signal ( target + )
\end{rail}

\begin{itemize}
\item \OSC{signal} is a name referring to an existing component of the \OSC{signal} node. 
\end{itemize}

\begin{rail}
target :  object ( ':' attribute ( | '[low,high]' ) + )
\end{rail}
\begin{itemize}
\item \OSC{object} is the name of an object (must be on the same hierarchy level than the \OSC{signal} node).
\item \OSC{attribute} is the name of the object target attribute (same name as the method used to set the attribute, e.g. \OSC{x}, \OSC{angle}, etc.).
\item an optional scaling feature is provided with the \OSC{[low,high]} suffix: signal values are expected to be between -1 and 1, the scaling suffix re-scale the input values between \OSC{low} and \OSC{high}.
\end{itemize}

\note{} \\
Connections are restricted to one-dimensional signals as source and to one-dimensional attribute as target. This is not a real limitation since any component of a multi dimensional attribute (e.g. \OSC{color}) is always available as a single attribute (e.g. \OSC{red} or \OSC{blue}).

\note{} \\
A connection can't cross the borders of a component i.e. the target object and the signal node should have the same parent.

\example \\
Connecting signals to attributes:
\sample{\icomment connects the values of sig1 to the red attribute of the 'rect' object \\
/ITL/scene/signal connect sig1 "rect:red"; \\
\icomment connects the values of sig2 to several objects and attributes \\
/ITL/scene/signal connect sig2 "rect:blue:x:rotatey[0,360]" "cursor:date[0,15]";
}
Disconnecting some of the previous connections :
\sample{/ITL/scene/signal disconnect sig2 "cursor:date" "rect:rotatey:blue"; }

%-------------------------------
%:    Graphic signals.
\sublevel{Graphic signals.}
\label{gsignal}

A graphic signal is the graphic representation of a set of parallel signals. It is created in the standard scene address space. A simple graphic signal is defined by a parallel signal controling the \values{y} deviation value, the thickness and the color at each time position. The color is encoded as HSBA colors (Hue, Saturation, Brightness, Transparency). The mapping of a signal value  (\values{[-1,1]}) to the HSBA color space is given by the table \ref{hsbamap}. 

\begin{figure}[h]
	\centering \includegraphics[width=65mm]{imgs/hsb}
 \caption{The HSB color space}
 \label{hsbfiug}
\end{figure}


\begin{table}[htbp]
\caption{HSBA color values.}
\begin{center}
\begin{tabular}{|r|cl|}
\hline
parameter & mapping & \\
\hline
\OSC{hue}				& \OSC{[-1,1]} & corresponds to \OSC{[-180,180]} angular degree where \OSC{0} is red. \\
\OSC{saturation}		& \OSC{[-1,1]} & corresponds \OSC{0\%} to \OSC{100\%} saturation. \\
\OSC{brigthness}		& \OSC{[-1,1]} & corresponds \OSC{0\%} (black) to \OSC{100\%} (white) brithgness. \\
\OSC{transparency}		& \OSC{[-1,1]} & corresponds \OSC{0\%} to \OSC{100\%} tranparency. \\
\hline
\end{tabular}
\end{center}
\label{hsbamap}
\end{table}



A graphic signal responds to common component messages (section \fullref{common}). Its specific messages are the following:

\index{Graphic signal!set}
\index{Graphic signal! dimension}

\begin{rail}
graphicSignal : 'set' graphtype signalIdentifier 
			| 'get' 'dimension'
\end{rail}

\begin{itemize}
\item the \OSC{set} message is followed by the graph type and a \OSC{\textit{signalIdentifier}}, where \OSC{signalIdentifier} must correspond to an existing signal from the \OSC{signal} address space. In case \OSC{signalIdentifier} doesn't exist, then a new signal is created at the \OSC{signalIdentifier} address with default values. 
\item the \OSC{get dimension} message gives the number of graphic signals in parallel (see section \fullref{pgsignal}). 
 \end{itemize}
 
\index{Graphic signal!graph}
\index{Graphic signal!fastgraph}
\index{Graphic signal!radialgraph}

\begin{rail}
graphtype : graph
			| fastgraph
			| radialgraph
\end{rail}

The signal representation type is among:
\begin{itemize}
\item \OSC{graph}: a classical signal representation as illustrated in figure \ref{graphimg}, where time is mapped to the x coordinate. 
\item \OSC{fastgraph}: a representation similar to the \OSC{graph} type, using a more efficient drawing strategy, but at the expense of a degraded graphic rendering. 
\item \OSC{radialgraph}: a signal representation where time is mapped to the polar coordinates. The rendering takes place in the ellipse enclosed in the object dimensions.
\end{itemize}

\example \\
Creating a signal and its graphic representation:
\sample{/ITL/scene/signal/y size 200 ; \\
\icomment use of constant anonymous signals for thickness and color\\
/ITL/scene/signal/sig set y 0.1 0. 1. 1. 1. ; \\
/ITL/scene/siggraph set graph sig ;
}

%-------------------------------
%:    Graphic signal default values.
\subsublevel{Graphic signal default values.}
\label{gsigdefault}

As mentionned above, a graphic signal expects to be connected to parallel signals having at least an \values{y} component, a graphic thickness component and HSBA components. Thus, from graphic signal viewpoint, the expected dimension of a signal should be equal or greater than 6. In case the \OSC{signalIdentifier} dimension is less than 6, the graphic signal will use the default values defined in table \ref{gsigdefault}.

\begin{table}[htbp]
\caption{Graphic signal default values.}
\begin{center}
\begin{tabular}{|r|cl|}
\hline
parameter & default value & \\
\hline
\OSC{y}					& \OSC{0} & the center line of the graphic \\
\OSC{thickness}		& \OSC{0} & \\
\OSC{hue}				& \OSC{0} & meaningless due to brigthness value \\
\OSC{saturation}		& \OSC{0} & meaningless due to brigthness value \\
\OSC{brigthness}		& \OSC{-1} & black \\
\OSC{transparency}		& \OSC{1} & opaque \\
\hline
\end{tabular}
\end{center}
\label{gsigdefault}
\end{table}

%-------------------------------
%:    Parallel graphic signals.
\subsublevel{Parallel graphic signals.}
\label{pgsignal}
When the dimension \textit{d} of a signal connected to a graphic signal is greater than 6, then the input signal is interpreted like parallel graphic signals. More generally, the dimension \textit{n} of a graphic signal is:
\[
n  \  |\ n \in \mathbb{N}\ \land\ 6.(n-1) < d \leqslant 6.n
\]
where \textit{d} is the dimension of the input signal.

When \textit{d} is not a mutiple of 6, then the last graphic signal makes use of the default values mentionned above.

 
\example \\
Creating parallel graphic signals:
\sample{/ITL/scene/signal/y1 size 200 ; \\
/ITL/scene/signal/y2 size 200 ; \\
\icomment use of constant anonymous signals for thickness and color\\
/ITL/scene/signal/sig1 set y1 0.1 0. 1. 1. 1. ; \\
\icomment use a different color for 'sig2'\\
/ITL/scene/signal/sig2 set y2 0.1 0.6 1. 1. 1. ; \\
\icomment put 'sig1' and 'sig2' in parallel\\
/ITL/scene/signal/sig set sig1 sig2;    \hspace{1CM}\icomment 'sig' dimension is 12\\
/ITL/scene/siggraph set graph sig; 
}

\note{} \\
Using data projection may be convenient when the input signal represents interleaved data. For example, the projection string \OSC{[n\~{}6]} distribute data over similar components of a set of graphic signals, where \OSC{n} represents the index of the graphic signal target component.



%===============================
%:Sensors
\input{Sensors/sensors.tex}


%===============================
%:Events and Interaction
\toplevel{Events and Interaction}
\label{interaction}

Interaction messages are user defined messages associated to \textit{events} and triggered when these events occur. These messages accept variables as message arguments.

\textit{Events} are typical user interface events (mouse or touch events), extended in the time domain and to specific objects or engine properties. Starting from INScore version 1.20, the modification of any object attribute may be viewed as an event and user defined events have also been introduced (see section \fullref{attributeevents} for more details). 

The general form of the message to \textit{watch} an event is the following:

\index{Interaction!watch}
\index{Interaction!watch+}

\begin{rail}
interactMsg : (('watch' | 'watch+')  ([1] | 
					what  ( [2] 
							| [3] "(" ( ( message  )+ "," ) ")" 
							| [4] message )  )) 
\end{rail}

\OSC{what} represents the event to watch and \OSC{message} is a list of associated messages, separated by a comma. Colon is also supported as separator (to avoid issues with comma in Max).

\begin{itemize}
\item [1]: clear all the messages for all the events.
\item [2]: clear the messages associated to the \OSC{what} event.
\item [3]: associate a list of messages to the \OSC{what} event. With \OSC{watch}, the messages replace previously associated messages. Using \OSC{watch+}, the messages are appended to the messages currently associated to the event.
\item [4]: associate or add a single message to the \OSC{what} event. This form is provided for compatibility with previous versions.
\end{itemize}

\note{} \\
	The [1] and [2] form has no effect with the \OSC{watch+} message. \\
	In some environments, the comma has a special meaning, making tricky to use it as a message separator. This is why ':' is also accepted as separator in OSC messages. \\
	The \OSC{get watch} message gives all the watch messages of a node, but doesn't take any argument.

\begin{rail} 
message : (| addressPrefix)  OSCAddress ( | (parameters | variable) + )
\end{rail}

The associated messages are any valid OSC message (not restricted to the INScore message set), with an extended address scheme, supporting IP addresses or host names and udp port number to be specified as OSC addresses prefix. The message parameters are any valid OSC type or variable (see section \ref{interactvar}).


\begin{rail} 
addressPrefix : (IPAddress | hostname) ':' port
\end{rail}

\example \\
An extended address to send messages to \OSC{localhost} on port \OSC{12000}:
\sample{localhost:12000/your/osc/address;}

%===============================
%:    Internal events
\sublevel{Internal events}
\label{defevents}

Internal events are triggered by the user interaction (mouse or touch events) or by the engine internal functionning.

%===============================
%:       Mouse events
\subsublevel{Mouse events}
\label{uievents}

User interface events are typical mouse events:

\index{Interaction!Events!mouseDown}
\index{Interaction!Events!mouseUp}
\index{Interaction!Events!mouseEnter}
\index{Interaction!Events!mouseLeave}
\index{Interaction!Events!mouseMove}
\index{Interaction!Events!doubleClick}
	
\begin{rail}
mouseEvent : 'mouseDown' | 'mouseUp' | 'mouseEnter' | 'mouseLeave' | 'mouseMove' | 'doubleClick' 
\end{rail}

\example \\
Triggering a message on mouse down:
\sample{/ITL/scene/myObject watch mouseDown (/ITL/scene/myObject show 0);}
\sampleindent the object hides itself on mouse click. \\
Triggering a message on mouse down but addressed to another host on udp port 12100:
\sample{/ITL/scene/myObject watch mouseDown (host.domain.org:12100/an/address start); }

\note{} \\
UI events are not supported by objects that are synchronized as slave.

Mouse events can be simulated using a \OSC{event} message:

\index{Interaction!Events!event}

\begin{rail}
uievt : 'event' mouseEvent x y
\end{rail}

where \OSC{mouseEvent} is one of the events described above, \OSC{x} and \OSC{y} are integer values giving the click position, expressed in pixels and relative to the target object.

\example \\
Simulating a mouse down at position 10, 10 :
\sample{/ITL/scene/myObject event mouseDown 10 10;}

%===============================
%:       Touch events
\subsublevel{Touch events}
\label{touchevents}
Depending on the display device, multi-touch events are supported by INScore :

\index{Interaction!Events!touchBegin}
\index{Interaction!Events!touchEnd}
\index{Interaction!Events!touchUpdate}

\begin{rail}
touchEvent : 'touchBegin' | 'touchEnd' | 'touchUpdate' 
\end{rail}

A typical sequence of generated events consists in a \OSC{touchBegin} event, followed by \OSC{touchUpdate} events and closed by a \OSC{touchEnd}.

%===============================
%:       Time events
\subsublevel{Time events}
\label{timeevents}

Events are also defined on the time domain:

\index{Interaction!Events!timeEnter}
\index{Interaction!Events!timeLeave}
\index{Interaction!Events!durEnter}
\index{Interaction!Events!durLeave}

\begin{rail}
timeEvent : 	'timeEnter' time time | 'timeLeave' time time 
		| 'durEnter' time time | 'durLeave' time time 
\end{rail}

Each event takes a time interval as parameter, defined by two \OSC{time} specifications (see section \fullref{time} for the time format)

\begin{itemize}
\item \OSC{timeEnter}, \OSC{timeLeave} are triggered when an object date is moved to or out of a watched time interval,
\item \OSC{durEnter}, \OSC{durLeave} are triggered when an object duration is moved to or out of a watched time interval.
\end{itemize}

\example \\
An object that moves a score to a given page number when it enters its time zone.
\samplev{/ITL/scene/myObject watch timeEnter 10/1 18/1 (/ITL/scene/score page 2);}

%===============================
%:       URL events
\subsublevel{URL events}
\label{urlevents}

\OSC{url} objects (i.e. intermediate objects for URL based objects (see section \fullref{filebasedrsrc}) support specific events, intended to reflect the transaction state:

\index{Interaction!Events!success}
\index{Interaction!Events!error}
\index{Interaction!Events!cancel}

\begin{rail}
urlEvent : 	'success'  
		| 'error'
		| 'cancel'
\end{rail}

\begin{itemize}
\item \OSC{success} is triggered when the data have been downloaded,
\item \OSC{error} is triggered when an error has occurred during the download,
\item \OSC{cancel} is triggered when the target url or the object type is changed while downloading.
\end{itemize}

\example \\
Triggering an error message in case of failure :
\sample{/ITL/scene/score set gmnf "http://ahost.adomain.org/score.gmn";\\
/ITL/scene/score watch error(\\
\hspace*{5mm}/ITL/scene/status set txt "Failed to download file"\\
);
}


%===============================
%:       Miscellaneous events
\subsublevel{Miscellaneous events}
\label{miscevents}

\index{Interaction!Events!export}
\index{Interaction!Events!newData}

\begin{rail}
miscEvent : 	  'export'
		| 'newData'
\end{rail}

\begin{itemize}
\item the \OSC{export} event is supported by all the components. It is triggered after an export message has been handled and could be used to simulate synchronous exports.
\item the \OSC{newData} event is supported by all the components. It is triggered when the object specific data are modified (typically using the \OSC{set} message).
\end{itemize}


%===============================
%:       Type specific events
\subsublevel{Type specific events}
\label{typespecevents}

\index{Interaction!Events!pageCount}
\index{Interaction!Events!newElement}
\index{Interaction!Events!endPaint}
\index{Interaction!Events!error}
\index{Interaction!Events!ready}
\index{Interaction!Events!end}

\begin{rail}
specificEvent : 	  'pageCount'
		| 'newElement'
		| 'endPaint'
		| 'error'
		| 'ready'
		| 'end'
\end{rail}

\begin{itemize}
\item the \OSC{pageCount} event is supported by all the symbolic score components (\OSC{gmn(f)}, \OSC{gmnstream}, \OSC{musicxml(f)}). It is triggered when the page count of the score changes. It is mainly intended to manage variable scores like \OSC{gmnstream}.
\item the \OSC{newElement} event is supported at scene level only and triggered when a new element is added to the scene.
\item the \OSC{endPaint} event is supported at scene level only and triggered after a scene has been painted.
\item the \OSC{error} event is supported at application level and triggered when an error occurs while receiving messages. 
Typically you can use of this event to open the log window (\OSC{/ITL/log show 1}) 
\item the \OSC{ready} event is supported by \OSC{video} objects. It is triggered when video data (duration, graphic dimensions) are available.
\item the \OSC{end} event is supported by \OSC{video} objects. It is triggered when a video is playing and reaches the end of the media. In this case, the object \OSC{play} status is automatically switched to 0 to reflect the actual player state.
\end{itemize}

\example \\
Displaying a welcome message to new elements:
\sample{/ITL/scene watch newElement (/ITL/scene/msg set txt "Welcome");}

%===============================
%:    Attribute based events
\sublevel{Attribute based events}
\label{attributeevents}

Attribute based events includes the whole set of messages that are supported by an object: \OSC{x}, \OSC{y}, \OSC{color}, etc. but also type specific messages. These events are triggered when a message has been succesfully processed. However, you shouldn't assume that the attribute value has been changed: when a message sets an attribute to it's current value, it is succesully processed and the corresponding event - if any - is triggered. 

\example \\
Watching an object \OSC{x} coordinate change:
\sample{/ITL/scene/myObject watch x (/ITL/scene/msg set txt "myObject moved");}

\note \\
Watching the \OSC{newData} event is equivalent to watch the \OSC{set} attribute. However, the \OSC{newData} event is triggered only when the object state is changed.

\warning \\
With the event's generalisation to any object attribute, a one tick delay has been introduced to all events. Thus the associated messages are not processed synchronously to the event but posted to be processed by the next time task. This delay has been introduced to avoid freezing the system in case of loops. However, it introduces also a pitfall in interaction design, when message based variables are used (see section \fullref{msgvar}): message based variables are evaluated at the event time while messages are processed by the next time task, thus the following messages won't produce the expected result:
\sample{/ITL/scene/myObject watch x ( \\
\hspace*{1cm} /ITL/scene/A x '\$(/ITL/scene/myObject get x)', \\
\hspace*{1cm} /ITL/scene/B x '\$(/ITL/scene/A get x)' \\
);
}
actually, when the \OSC{\$(/ITL/scene/A get x)} variable is evaluated, the preceding message that sets the x attribute of A has not been aready processed.
One workaround consists in splitting the interaction in several parts, making sure that the messages are processed e.g.
\sample{/ITL/scene/myObject watch x ( /ITL/scene/A x '\$(/ITL/scene/myObject get x)'); \\
/ITL/scene/A watch x ( /ITL/scene/B x '\$(/ITL/scene/A get x)' );
}




%===============================
%:    User defined events
\sublevel{User defined events}
\label{userevents}

INScore events supports user defined events. The name of user defined events must start with a capital letter and be composed of capital letters and/or numbers. Other characters are reserved for INScore use.

Messages attached to user defined events accept regular variables (although the position variables are useless), 
but they accept also any number of a variables which names are \$1, ... \$i and which values are taken from the event call arguments (see section \fullref{udevar}).

User defined events can only be triggered using the \OSC{event} message (see section \fullref{eventMsg}).

\example \\
Watching and triggering a user defined event:
\sample{/ITL/scene/myObject watch MYEVENT (/ITL/scene/msg set txt "MYEVENT occured!");\\
/ITL/scene/myObject event MYEVENT;
}

Defining high level abstractions:
\sample{/ITL/scene/myObject watch MOVEABC ( \\
\hspace*{1cm}/ITL/scene/a x \$1,\\
\hspace*{1cm}/ITL/scene/b x \$2,\\
\hspace*{1cm}/ITL/scene/C x \$3\\
); \\
/ITL/scene/myObject event MOVEABC -0.4 0.1 0.6;
}


%===============================
%:    The event message
\sublevel{The 'event' message}
\label{eventMsg}

The \OSC{event} message may be used to triggered events. It's the only way to trigger user defined events. 
It may be used also to simulate user interface events (like mouse events).

\index{Common messages!event}

\begin{rail}
eventMsg :  'event' 
			([1] ( (mouseEvent | touchEvent) float32 float32) 
			| [2] userEvent ( | var +)
			| [3] eventName
			)
\end{rail}

\begin{itemize}
\item \textbf{1}: this form is intended to simulate mouse or touch event. It must be followed by the x and y coordinates of the interaction point. Coordinates express a position in pixels (the top left corner of the object is in [0,0]).
\item \textbf{2}: triggers a user defined event. It accepts any number of arguments, that are then expanded in place of the variables \$1 ... \$i. User defined events may be viewed as functions with arbitrary parameters; however parameters count and type is not checked. 
\item \textbf{3}: triggers any other event. 
\end{itemize}

\note \\
Time events are excluded from the \OSC{event} message supported events: to trigger a time event, you can use a \OSC{date} message.



%===============================
%:    Variables
\sublevel{Variables}
\label{interactvar}

Variables are values computed when an event is triggered. These values are send in place of the variable. A variable name starts with a '\$' sign. 

%===============================
\subsublevel{Position variables}
\label{posvar}

Position variables reflects the current mouse position for mouse events or the current touch position for touch events. 
For attribute based events, the \OSC{x} and  \OSC{y} variables are set to the target object current position and the other variables are undefined. For other events, the position variables are set to \values{0}. 

\index{Interaction!variable!x}
\index{Interaction!variable!y}
\index{Interaction!variable!absx}
\index{Interaction!variable!absy}
\index{Interaction!variable!sx}
\index{Interaction!variable!sy}

\begin{rail} 
posVar : xy | 'absx' | 'absy' | 'sx' | 'sy' 
\end{rail}

where
\begin{rail} 
xy : ('x' | 'y') ( | '[low,high]') 
\end{rail}

\begin{itemize}
\item \OSC{\$x} \OSC{\$y}: denotes the mouse pointer position at the time of the event. The values are in the range \values{[0,1]} where 1 is the object size in the x or y dimension. The value is computed according to the object origin: it represents the mouse pointer distance from the object x or y origin (see \fullref{origin}). \OSC{\$x} and \OSC{\$y} variables support an optional range in the form \OSC{[low, high]} that transforms the \values{[0,1]}  values range into the \values{[low, high]} range.

\item \OSC{\$absx} \OSC{\$absy}: denotes the mouse pointer absolute position at the time of the event. The values represent a pixel position relative to the top-left point of the target object. Note that this position is unaffected by scale. 
Note also that the values are not clipped to the object dimensions and could exceed its width or height or become negative in case of mouse move events.

\item \OSC{\$sx} \OSC{\$sy}: denotes the mouse pointer position in the scene coordinates space. 
\end{itemize}

\example \\
An object that follows mouse move.\\
\sample{/ITL/scene/myObject watch mouseDown ( \\
\hspace*{3cm}/ITL/scene/myObject x '\$sx', \\
\hspace*{3cm}/ITL/scene/myObject y '\$sy' );
}


%===============================
\subsublevel{Sensor variables}
\label{sensorvar}

Sensors values are available using the \OSC{\$x}, \OSC{\$y} and \OSC{\$z} variables, for events generated in the context of a sensor.
\begin{rail} 
xyz : ('x' | 'y' | 'z') ( | '[low,high]') 
\end{rail}
Note that depending on the sensor type, the \OSC{\$y} and \OSC{\$z} variables may be useless.


%===============================
\subsublevel{Time variables}
\label{timevar}

Time variables reflects the date corresponding to the current mouse position for mouse events. For attribute based events, the time variables are set to the target object current time position.
They are set to \values{0} for the other events. 

\index{Interaction!variable!date}
\index{Interaction!variable!rdate}

\begin{rail} 
timeVar :  ('date' | 'rdate') (| ':'  mapname) (| '[n/d]') (| '\%' 'f')
\end{rail}

\begin{itemize}
\item \OSC{\$date}: denotes the object date corresponding to the mouse pointer position at the time of the event. It is optionnaly followed by a colon and the name of the mapping to be used to compute the date. The \OSC{\$date} variable is replaced by its rational value (i.e. two integers values). The optional rational enclosed in brackets may be used to indicate a quantification: the date value is rounded to an integer count of the specified rational value. The optional \OSC{\%f} may be used to get the date delivered as a float value.
\item \OSC{\$rdate}: is similar to \OSC{\$date} but ignores the target current date: the date is relative to the object mapping only.
\end{itemize}

\note{} \\
A variable can be used several times in a message, but several \OSC{\$date} variables must always refer to the same mapping.

\example \\
Sending the current date as a float value to an external application:\\
\sample{/ITL/scene/myObject watch mouseDown ( targetHost:12000/date '\$date\%f' );}

%===============================
\subsublevel{Miscellaneous variables}
\label{miscvar}

\index{Interaction!variable!scene}
\index{Interaction!variable!name}
\index{Interaction!variable!address}

\begin{rail} 
variable :  'name' | 'scene' | 'address'
\end{rail}

\begin{itemize}
\item \OSC{\$name} is replaced by the target object name.
\item \OSC{\$scene} is replaced by the target object scene name.
\item \OSC{\$address} is replaced by the target object OSC address. 
\end{itemize}

\note{} \\
For the \OSC{newElement} event, the target object is the new element. 

\example \\
Using an object name:
\sample{/ITL/scene watch newElement (/ITL/scene/welcome set txt "Welcome" '\$name');}

%===============================
%:    Message based variables
\subsublevel{Message based variables}
\label{msgvar}

A message based variable is a variable containing an OSC message which will be evaluated at the time of the event. They are supported by all kind of events. Like  the variables above, a message based variable starts with a '\$' sign followed by a valid 'get' message enclosed in parenthesis:
\begin{rail} 
msgVar : '(' oscaddress 'get' (| params) ')'
\end{rail}

The evaluation of a 'get' message produces a message or a list of messages. The message based variable will be replaced by the parameters of the messages resulting from the evaluation of the 'get' message.
Note that all the 'get' messages attached to an event are evaluated at the same time.

\example \\
An object that takes the \values{x} position of another object on mouse down:
\sample{/ITL/scene/myObject watch mouseDown \\
\hspace*{3cm}(/ITL/scene/myObject x '\$(/ITL/scene/obj get x)');
}

%===============================
%:    Variables for user defined events
\subsublevel{Variables for user defined events}
\label{udevar}

Messages associated to user defined events accept any number of a variables which names are \$1, ... \$i and which values are taken from the event call arguments. These events may be viewed as functions with arbitrary parameters; however parameters count and type is not checked: arguments in excess are ignored and variables without corresponding argument (e.g. \$3 when only 2 arguments are available) are left unexpanded.




%===============================
%:    OSC address variables
\subsublevel{OSC address variables}
\label{oscvar}
The OSC address of a message associated to an event supports the following variables:
\begin{itemize}
\item \OSC{\$self}: replaced by the object name.
\item \OSC{\$scene}: replaced by the scene name.
\end{itemize}

\example \\
Requesting a set of objects to send a message to themselves on a mouse event:
\sample{/ITL/scene/* watch mouseDown \hspace*{2.4cm}\icomment request all the objects of the scene \\
\hspace*{2.7cm}(/ITL/scene/\$self x '\$sx'); \icomment to send a message to themselves
}

%===============================
%:    Interaction state management
\sublevel{Interaction state management}
\label{evtstate}

For a given object, its \emph{interaction state} (i.e. the watched events and the associated messages) can be saved and restored.

\index{Interaction!push}
\index{Interaction!pop}

\begin{rail} 
stateMsg : 'push' | 'pop'
\end{rail}

Interaction states are managed using a stack where the states are pushed to or popped from.
\begin{itemize}
\item \OSC{push}: push the current interaction state on top of the stack.
\item \OSC{pop}: replace the current interaction state with the one popped from the top of the stack.
\end{itemize}

The different states stored in this stack can be obtain with the message :

\begin{rail} 
stackMsg : 'get' 'stack'
\end{rail}

\note{} \\
The effect of a pop message addressed to an object with an empty stack is to clear the object current interaction state.


%===============================
%:    File watcher
\sublevel{File watcher}
\label{filewatch}

The \OSC{fileWatcher} is a static node of a scene that is intended to watch file modifications. \\
It receives messages at the address \OSC{/ITL/scene/fileWatcher}.

The \OSC{fileWatcher} support the \OSC{watch} and \OSC{watch+} messages as described in section \fullref{interaction} with a file name used in place of the \OSC{what} parameter.

\index{File Watcher!watch}
\index{File Watcher!watch+}

\begin{rail}
fileWatcher : (('watch' | 'watch+')  ( | filePath  ( |  ( ( message  )+ "," ) )  )) 
\end{rail}

\example \\
Reload aa INScore script on file modification:
\sample{
/ITL/scene/fileWatcher watch 'myScript.inscore' \\
\hspace*{3cm}( /ITL/scene load 'myScript.inscore' );
}


%===============================
%:Scripting
\toplevel{Scripting}
\label{scripting}

INScore saves its state to files containing textual OSC messages. These files can be edited or created from scratch using any text editor. In order to provide users with a scripting language, the OSC syntax has been extended at textual level.

%===============================
%:    Statements
\sublevel{Statements}
\label{scriptstatement}
An INScore file is a list of textual expressions. A script expression is:
\begin{itemize}
\item a message: basically a textual OSC message extended to support URL like addresses and variables as parameters.
\item a variable declaration.
\item a foreign language script that may generate messages as output.
\item an end marker '\OSC{\_\_END\_\_}' to declare a script end. After the marker, the remaining part of the script will be ignored.
\end{itemize}

\index{Scripting!expressions}

\begin{rail}
expression :  
		 	message ";"
		| 	variabledecl ";"
		| 	script
		|   end
\end{rail}

Messages and variables declarations must be followed by a semicolon, used as statements separator.

%===============================
%:    Messages
\sublevel{Messages}
\label{scriptmsgs}

Messages are basically OSC messages that support the address extension scheme described in section \fullref{interaction} and relative addresses that are described below.
Messages parameters can be replaced by variables that are evaluated at parsing level. Variables are described in section \ref{scriptvar}.

Using the address extension scheme, a script may be designed to initialize an INScore scene and external applications as well, including on remote hosts.

\example\\
Initializing a score and an external application listening on port 12000 and running on a remote host named \OSC{host.adomain.net}.
\sample{/ITL/scene/score set gmnf 'myscore.gmn';\\
host.adomain.net:12000/run 1;
}

Relative addresses have been introduced to provide more flexibility in the score design process. A relative address starts with '\OSC{./}'. It is evaluated in the context of the message receiver: a legal OSC address is dynamically constructed using the receiver address that is used to prefix the relative address. 

\example
\sample{the relative address \hspace*{3mm}./score \\
addressed to \hspace*{15.4mm}/ITL/scene/layer\\
will be evaluted as \hspace*{4mm}/ITL/scene/layer/score
}

The receiver context may be:
\begin{itemize}
\item the INScore application address (i.e. \OSC{/ITL}) for messages enclosed in a file loaded at application level (using the \OSC{load} message addressed to the application) or for files dropped to the application or given as arguments of the INScoreViewer application.
\item a scene address for messages enclosed in a file loaded at scene level (using the \OSC{load} message addressed to a scene) or for files or messages dropped to a scene window.
\item any object address when the messages are passed as arguments of an \OSC{eval} message (see section \fullref{miscmsgs}).
\end{itemize}

\example\\
Using a set of messages in different contexts:
\sample{score = (\\
\hspace*{5mm}./score set gmn '[a f g]', \\
\hspace*{5mm}./score scale 2.\\
);\\
/ITL/scene/l1 eval \$score;\\
/ITL/scene/l2 eval \$score;
}

\note{}\\
Legal OSC addresses that are given as argument of an \OSC{eval} message are not affected by the evaluation.


%===============================
%:    types
\sublevel{Types}
\label{scripttypes}

Using OSC, the message parameters are typed by the OSC protocol. 
With their textual version, any parameter is converted to an OSC type (i.e. int32, float or string) at parsing level.
A special attention must be given to strings in order to discriminate addresses and parameters. Strings intended as parameters must:
\begin{itemize}
\item be quoted, using single or double quotes. Note that an ambiguous quote included in a string can be escaped using a '\verb+\+'.
\item or make use of the following characters set: \OSC{[-a-zA-Z0-9]+} or \OSC{[\_a-zA-Z][\_a-zA-Z0-9]*}.
 \end{itemize}

\example \\
Different string parameter
\sample{/ITL/scene/text set txt "Hello world";  \icomment string including a space must be quoted \\
/ITL/scene/img set file 'anImage.png';  \icomment dots must be quoted too \\
/ITL/scene/foo set txt no\_quotes\_needed;
}


%===============================
%:    Variables
\sublevel{Variables}
\label{scriptvar}

A variable declaration associates a name with a list of parameters or a list of messages.
Parameters must follow the rules given in section \ref{scripttypes}. They may include previously declared variables. A message list must be enclosed in parenthesis and a comma must be used as messages separator.

\index{Scripting! variable}

\begin{rail} 
variabledecl : 'ident' '=' ( (param | variable) +
					| '(' (message + ',') ')' ) ';'
\end{rail}

\example \\
Variables declarations
\sample{color = 200 200 200; \\
colorwithalpha = \$color 100; \icomment using another variable \\
msgsvar= ( \hspace*{2.7cm}  \icomment a variable referring to a message list \\
\hspace*{1cm} localhost:7001/world "Hello world", \\
\hspace*{1cm} localhost:7001/world "how are you ?" );
}


A variable may be used in place of any message parameter. A reference to a variable must have the form \OSC{\$ident} where \OSC{ident} is a previously declared variable. A variable is evaluated at parsing level and replaced by its content.

\example \\
Using a variable to share a common position:
\sample{x = 0.5;\\
/ITL/scene/a x \$x;\\
/ITL/scene/b x \$x;
}

Variables can be used in interaction messages as well, which may also use the variables available in the interaction context (see section \fullref{interactvar}). To differentiate between a \emph{script} and an \emph{interaction} variable, the latter must be quoted to be passed as strings and to prevent their evaluation by the parser. 

\example \\
Using variables in interaction messages: \$sx is evaluated at event occurrence	and \$y is evaluated at parsing level.
\sample{y = 0.5;\\
/ITL/scene/foo watch mouseDown (/ITL/scene/foo "\$sx" \$y);
}

%===============================
%:    Environnement variables
\sublevel{Environnement variables}
\label{envvar}

Environnement variables are predefined variables available in a script context. They provide information related to the current context. Current environment variables are:
\begin{itemize}
\item \textbf{\OSC{OSName}}: gives the current operating system name. The value is among \OSC{"MacOS"}, \OSC{"Windows"}, \OSC{"Linux"}, \OSC{"Android"} and \OSC{"iOS"}.
\item \textbf{\OSC{OSId}} : gives the current operating system as a numeric identifier. Returned value is (in alphabetic order): 
\begin{itemize}
\item 1 for Android
\item 2 for iOS.
\item 3 for Linux, 
\item 4 for MacOS, 
\item 5 for Windows, 
\end{itemize}
\end{itemize}

\note\\
There is nothing to prevent overriding of an environment variable. It's the script responsibility to handle variable names collisions.


%===============================
%:    Message based parameters
\sublevel{Message based parameters}
\label{scriptmsgparam}

Similarly to message based variables (see section \fullref{msgvar}), a message parameter may also use the result of a \OSC{get} message as parameters specified like a message based variable.
The message must be enclosed in parameters with a leading \$ sign.

\index{Scripting! message based parameters}

\begin{rail} 
msgparam : '(' (message) ')'
\end{rail}

\example \\
Displaying INScore version using a message parameter:
\sample{/ITL/scene/version set  txt "INScore version is" \$(/ITL get version);}

\note{}\\
Message based parameters are evaluated by the parser. Thus when the system state is modified by a script before a message parameter, these modifications won't be visible at the time of the parameter evaluation because all the messages will be processed by the next time task. For example:\\
\sample{/ITL/scene/obj x 0.1;\\
/ITL/scene/foo x \$(/ITL/scene/foo get x);
}
x position of \OSC{/ITL/scene/foo} will be set to x position of \OSC{/ITL/scene/obj} at the time of the script evaluation (that may be different to 0.1).

%===============================
%:    languages
\sublevel{Languages}
\label{scriptlang}

\index{Scripting!javascript}
%\index{Scripting!lua}

INScore supports Javascript and Lua as scripting languages. Javascript is embedded by default (using the Qt Javascript engine). INScore needs to be recompiled to embed the Lua engine\footnote{\url{http://www.lua.org/}}. A script section is indicated similarly to a Javascript section in html i.e. enclosed in an opening \OSC{<?} and a closing \OSC{?>}.

\index{Scripting! javascript}
%\index{Scripting! lua}

\begin{rail} 
script : '<?' ('javascript' | 'lua') script '?>'
\end{rail}

The principle of using an embedded programming language in script files is the following: \emph{javascript} or \emph{lua} sections are given to the corresponding engine and are expected to produce INScore messages on output.
These messages are then parsed as if replacing the corresponding script section.

Note that INScore variables are exported to the current language environment.

\example
\sample{
<?javascript \\
\hspace*{3mm} "/ITL/scene/version set 'txt' 'Javascript v."  + version() + "';"; \\
\hspace*{1mm} ?>
}

A single persistent context is created at application level and shared to each scene.

\note Lua support is going to be deprecated and should be removed in a future release.

%===============================
%:    The Javascript objects
\subsublevel{The Javascript object}
\label{jsobj}

The Javascript engine is available at runtime at the address \OSC{/ITL/\textit{scene}/javascript}. It has a \OSC{run} method that takes a javascript string as parameter.

\index{Scripting! javascript! run}

\begin{rail} 
javascript :  'run' 'code'
\end{rail}

The \OSC{run} method evaluates the code. Similarly to javascript sections in scripts, the output of the evaluation is expected to be a string containing valid INScore messages that are next executed. 
Actually, including a javascript section in a script is equivalent to send the \OSC{run} message with the same code as parameter to the javascript object.

The Javascript engine is based on the Qt5 Javascrip engine, extended with additional functions:
\begin{itemize}
\item \textbf{\OSC{version()}} : gives the javascript engine version number as a string.
\item \textbf{\OSC{print(val1 [, val2 [, ...]])}} : print the arguments to the OSC standard output. The arguments list is prefixed by 'javascript:'. The function is provided for debug purpose.
\item \textbf{\OSC{readfile(file)}} : read a file and returns its content as a string. The file name could be specified as an absolute or relative path. When relative, the file is searched in the application current \OSC{rootPath} (see section \fullref{applmgmt}).
\item \textbf{\OSC{post(address [,...])}} : build an OSC message and post it for delayed processing i.e. to be processed by the next time task. \OSC{address} is an OSC or an extended OSC address. Optional arguments are the message parameters.
\item \textbf{\OSC{osname()}} : gives the current operating system name. Returned value is among \OSC{"MacOS"}, \OSC{"Windows"}, \OSC{"Linux"}, \OSC{"Android"} and \OSC{"iOS"}.
\item \textbf{\OSC{osid()}} : gives the current operating system as a numéric identifiant. Returned value is (in alphabetic order): 
\begin{itemize}
\item 1 for Android
\item 2 for iOS.
\item 3 for Linux, 
\item 4 for MacOS, 
\item 5 for Windows, 
\end{itemize}
\end{itemize}


\example
\sample{
<?javascript \\
\hspace*{3mm} post ("/ITL/scene/obj", "dalpha", -1);";\\ 
\hspace*{3mm} \# The message /ITL/scene/obj dalpha -1 \\
\hspace*{3mm} \# will be evaluated by the next time task. \\
?>
}

\example
\sample{
<?javascript \\
\hspace*{3mm} \# declare a function foo() \\
\hspace*{3mm} function foo(arg) \{\\ 
\hspace*{6mm}  return "/ITL/scene/obj set txt foo called with " + arg + ";"; \\
\hspace*{3mm} \} \\
?>\\
\\
\# call the foo function \\
<?javascript foo(1)?>\\
\\
\# or call the foo function using the run message \\
/ITL/scene/javascript run "foo(1)";
}


%\note{}\\
%The effect of \OSC{load} message is actually to push the messages on the system stack for evaluation by the next time task. Thus when including a file containing javascript (or lua), the new 
%language context won't be available to the next messages in the script. The workaround 
%for structured script consists in designing a top level script that only contains \OSC{load} messages.
%
%\example
%\sample{
%\hspace*{-3mm} /ITL load 'javascript-code.inscore';\\
%/ITL load 'call-javascript.inscore';
%}


%===============================
%:Math expressions
\input{MathExpressions/mathexpressions.tex}

%===============================
%:Score expressions
\input{scorexpressions.tex}

%===============================
%:Plugins
\toplevel{Plugins}
\label{plugins}

A plugin is an external library that is dynamically loaded when an object that need it is created.
The system looks for plugins in the following locations:
\begin{itemize}
\item in the current folder first
\item in the PlugIns folder, located in the application bundle on macos, in the application folder on other systems
\item in the system default locations for shared libraries
\end{itemize}
Additionaly, a user path can be set, where the system will look for plugins in first position. See section \fullref{ITLplugins}.

The plugins are shared libraries which extension is platform dependent. The plugin name should not include the extension. The expected extensions are the following: .dylib on MacOS and Linux, .dll on Windows.



%===============================
%:   FAUST plugins
\sublevel{FAUST plugins}
\label{faust}

FAUST [Functional Audio Stream]\footnote{\url{http://faust.grame.fr}} is a functional programming language specifically designed for real-time signal processing and synthesis. A FAUST/INScore architecture allows to embed FAUST processors in INScore, for the purpose of signals computation. A FAUST plugin is viewed as a parallel signal and thus it is created in the \OSC{signal} address space. Similarly to signals, it is associated to an OSC address in the form \OSC{/ITL/\emph{scene}/signal/\emph{name}} where \OSC{\emph{name}} is a user defined name.

\subsublevel{Set Message}
\label{faustsetmsg}

There are two ways to create a FAUST Processor : 
\begin{itemize}
\item [1]- By charging a DSP as a plugin already compiled \\

\index{Faust Processor!set (plugin)}

\begin{rail}
faustprocessor : 'set' 'faust' path
\end{rail}

\example \\
\sample{/ITL/scene/signal/myFaust set faust aFaustPlugin;}

\note{} \\
The plugin name should not include the extension. The expected extensions are the following: .dylib on MacOS and Linux, .dll on Windows. \\

\item [2]- By charging libfaust as a plugin to compile a DSP on-the-fly  (as a string or a file). \\

\index{Faust Processor!set (dsp)}

\begin{rail}
faustdsp : 'set' 'faustdsp' faustcode
\end{rail}

\vspace{0.3cm}

\index{Faust Processor!set (dsp file)}

\begin{rail}
faustdspfile : 'set' 'faustdspf' faustfile
\end{rail}

\example \\
\sample{/ITL/scene/signal/plus set faustdsp "process=+;"; \\
/ITL/scene/signal/mydsp set faustdspf "mydsp.dsp";
}

\end{itemize}

%===============================
%:      Specific messages
\subsublevel{Specific messages}
\label{faustmsg}
A FAUST processor is characterized by the numbers of input and output channels and by a set of parameters. Each parameter carries a name defined by the FAUST processor. The set of messages supported by a FAUST processor is the set of signals messages extended with the parameters names and with specific query messages. 

\index{Faust Processor!in}
\index{Faust Processor!out}
\index{Faust Processor!min}
\index{Faust Processor!max}

\begin{rail}
faustmessage : signalMsgs
			 | [1] 'msg' float32
			 | [2] 'get' ('in' | 'out')
\end{rail}

\begin{itemize}
\item [1] \OSC{\emph{msg}} is any of the FAUST processor parameters, which are defined by the FAUST processor.
\item [2] the \OSC{get} message is extended to query the FAUST processor: \OSC{in} and \OSC{out} give the number of input and output channels.
% \OSC{msgs} gives the list of the processor specific messages under the form of separate messages including the message name followed by its default, minimum and maximum values.
\end{itemize}

\example \\
Querying a FAUST processor input and output count:
\sample{/ITL/scene/signal/myFaust get in out;}
\sampleindent gives as output:
\sample{/ITL/scene/signal/myFaust in 2; \\
/ITL/scene/signal/myFaust out 4;
}
Modifying the value of a FAUST processor parameter named \OSC{volume}:
\sample{/ITL/scene/signal/myFaust volume 0.8}

%===============================
%:      Feeding and composing FAUST processors
\subsublevel{Feeding and composing FAUST processors}
\label{composefaust}

A FAUST processor accepts float values as input, which are taken as interleaved data and distributed to the input channels.

From composition viewpoint, a FAUST processor is a parallel signal which dimension is the number of output channels. 
Thus, a FAUST processor can be used like any parallel signal. However, the signal identifier defined in \ref{parcomp} is extended to support adressing single components of parallel signal as follows:
\begin{rail}
signal :  
		  identifier ( | "/" n)
		| float32
\end{rail}
where \values{n} selects the signal \#n of a parallel signal. Note that indexes start at 0.

\example \\
Creating 3 parallel signals using the 3 output channels of a FAUST processor named \OSC{myFaust}:
\sample{/ITL/scene/signal/y1 set 'myFaust/0' 0.01 0. 1. 1. 1. ;\\
/ITL/scene/signal/y2 set 'myFaust/1' 0.01 0.5 1. 1. 1. ;\\
/ITL/scene/signal/y3 set 'myFaust/2' 0.01 -0.5 1. 1. 1. ;
}


%===============================
%:    Gesture Follower
\sublevel{Gesture Follower}
\label{GF}

INScore supports gesture following using the technology developed by the IRCAM IMTR team. These features are available as a plugin that is included in the INScore distribution (version 1.03 or greater) or available from the IRCAM.
%available from the IRCAM. The plugin installation is documented in the accompanying readme file.

%===============================
%:        Basic principle
\subsublevel{Basic principle}
\label{gfbasic}
Gesture following is provided as a mean to interact with a score. From input viewpoint, the gesture follower is similar to signals (see section \fullref{ssignal}): it accepts data stream as input both in learning and following modes. It implements a specific set of events related to gesture following and can generate message streams parametrized with the gesture follower current state.

A gesture follower is setup to handle a given count of gestures, which are actually denoted by streams of float vectors. We'll refer to the size of the float vector as the \emph{gesture dimension}. For example, the dimension of a gesture captured from x, y and z accelerometers is 3.

A gesture follower operates in two distinct phases: a \emph{learning phase} where it actually stores the gestures data, and a \emph{following phase} where it tries to match incoming data to the stored gestures data. When not learning nor following, we'll talk of an idle phase. 

In the \emph{following phase}, the system maintains a list of likelihood for the learned gestures, a list of positions in the gestures and a list of speeds representing how fast the gestures are made. Of course, the higher the likelihood, the more these data are meaningfull. It's the user responsability to decide on the meaningfull likelihood threshold value. Interaction events are triggered only in the \emph{following phase} and for meaningfull likelihoods.

%===============================
%:        Messages
\subsublevel{Messages}
\label{gfmessages}
A gesture follower is created in a scene using the \OSC{imtrgf} type. It has a graphic appearance that may be used for debug purpose but it is hidden by default.

\index{Gesture follower}

\begin{rail}
gesturefollower : 'set' 'imtrgf' gesturedimension bufsize ( name + )
\end{rail}

The parameters are:
\begin{itemize}
\item \OSC{gesturedimension}: the size of the gestures data vector.
\item \OSC{bufsize}: the size of the gesture data storage.
\item \OSC{name}: a list of names to be used to refer to the learned gestures.
\end{itemize}

\note{} \\
A gesture follower is created with a fixed count of gestures that can be learned and decoded. These gestures are named gestures and can be addressed at \OSC{/ITL/\textit{scene}/\textit{myfollower}/\textit{gesturename}} where the part in italic are user defined names and where \OSC{myfollower} is a gesture follower.

\index{Gesture follower!learn}
\index{Gesture follower!follow}
\index{Gesture follower!stop}
\index{Gesture follower!likelihoodwindow}
\index{Gesture follower!tolerance}

\begin{rail}
gesturefollowerMsgs :
		  [1] ( float32 + )
		| [2] ('learn' name)
		| [3] 'follow'
		| [4] 'stop'
		| [5] 'clear'
		| [6] ('likelihoodwindow' float32)
		| [7] ('tolerance' float32)
\end{rail}

\begin{itemize}
\item \textbf{[1]} input data into the gesture follower. The data are interpreted according to the current operating mode i.e. learning, following or idle.
\item \textbf{[2]} starts to learn the gesture designated by \emph{name}. Actually records the next input data to the gesture. 
\item \textbf{[3]} starts following i.e. trying to match the next input data to the recorded gestures.
\item \textbf{[4]} stops learning or following. Actually puts the system in idle phase.
\item \textbf{[5]} clear all the gestures data. This is equivalent to send the \OSC{clear} message to all the gestures. 
\item \textbf{[6]} sets the size of the window that contains the history of the likelihoods. May be viewed as how fast the likelihoods	will change.
\item \textbf{[7]} sets the follower tolerance. 
\end{itemize}

\example \\
Creating a gesture follower for 3 dimensional data and a typical learning sequence:
\sample{/ITL/scene/gf set imtrgf 3 1000 gestureA gestureB gestureC gestureD ;\\
/ITL/scene/gf learn gestureA ;\\
/ITL/scene/gf 0.1 0.5 -0.2 ... 0.7; \icomment the data size must be a multiple of 3\\
/ITL/scene/gf stop;
}

%===============================
%:        Gestures management
\subsublevel{Gestures management}
\label{gfgestures}

Messages can also be sent to gestures i.e. to addresses in the form \OSC{/ITL/\textit{scene}/\textit{myfollower}/\textit{gesturename}} where \OSC{myfollower} is a gesture follower.

A gesture could be in two states:
\begin{itemize}
\item an active state: when its likelihood is greater or equal to the likelihood threshold.
\item an idle state: when its likelihood is lower than the likelihood threshold.
\end{itemize}

\index{Gesture follower!set}
\index{Gesture follower!likelihoodThreshold}
\index{Gesture follower!learn}
\index{Gesture follower!clear}

\begin{rail}
gesture : 'set' ( float32 +)
		| 'clear'
		| 'learn'
 		| 'likelihoodThreshold' float32
\end{rail}

\begin{itemize}
\item \OSC{set}: sets the gesture data. This is equivalent to learn the corresponding data. The \OSC{set} message could be used to restored previously saved gesture data.
\item \OSC{clear}: clears the gesture data. 
\item \OSC{learn}: puts the gestures follower in learning mode and starts learning the corresponding gesture. This is equivalent to send OSC{learn \textit{gesturename}} to the parent gesture follower.
\item \OSC{likelihoodThreshold}: sets the gesture likelihood threshold. The parameter is a float value in the range \values{[0,1]}. Default value is \values{0.5}.
\end{itemize}

Gestures supports also specific queries :

\index{Gesture follower!get}
\index{Gesture follower!get!size}

\begin{rail}
gestureget : 'get' (| 'likelihoodThreshold' | 'size')
\end{rail}

\begin{itemize}
\item \OSC{get}: without parameter, returns a set message when the gesture is not empty.
\item \OSC{size}: gives the current size of the gesture, actually the number of recorded frames. 
\end{itemize}


%===============================
%:        Events and interaction
\subsublevel{Events and interaction}
\label{gfevents}

Events are defined at gesture level and events management messages should be addressed to gestures. 

\index{Gesture follower!watch}
\index{Gesture follower!gfEnter}
\index{Gesture follower!gfLeave}
\index{Gesture follower!gfActive}
\index{Gesture follower!gfIdle}

\begin{rail}
gestureevents :
		  	'watch' ( | 'gfEnter' | 'gfLeave' | 'gfActive' | 'gfIdle' )  (  |  messages )
\end{rail}

\begin{itemize}
\item \OSC{gfEnter} triggered when the gesture state changes from idle to active.
\item \OSC{gfLeave} triggered when the gesture state changes from active to idle.
\item \OSC{gfActive} triggered in active state each time the gesture likelihood is refreshed.
\item \OSC{gfIdle} triggered in idle state each time the gesture likelihood is refreshed.
\end{itemize}

A message associated to a gesture supports the following specific variables:

\index{Gesture follower!gflikelihood}
\index{Gesture follower!gfpos}
\index{Gesture follower!gfspeed}

\begin{rail}
gesturevariable : 
		( 'gflikelihood'
		| 'gfpos'
		| 'gfspeed') ( | '[low,high]' ) 
\end{rail}

These variables support the scaling feature associated to position variables and described in section \fullref{posvar}.
\begin{itemize}
\item \OSC{gflikelihood} indicates the current likelihood 
\item \OSC{gfpos} indicates the current position in the gesture 
\item \OSC{gfspeed} indicates the current gesture execution speed 
\end{itemize}

\note{}\\
Variables described in section \fullref{interactvar} may also be used but they are meaningless and contains default values.


%===============================
%:        Gesture Follower Appearance
\subsublevel{Gesture Follower Appearance}
\label{gfgraphs}

A gesture follower object has a graphic appearance and supports all the standard objects properties, including mapping and synchronization. This graphic appearance is provided mainly for debug purpose and by default, the object is hidden. Figure  \ref{fig:gfgraph} shows the gesture follower appearance in its different phases:
\begin{itemize}
\item when idle, the upper part of the graphic indicates the buffer state of the different gestures. It also includes the gestures likelihood threshold.
\item when learning, a red frame and a grey background indicates that a learning a gesture is currently in progress. The gesture buffer state is refreshed while learning.
\item when following, the upper part indicates each gesture current likelihood and the lower part indicates the current estimated positions.
\end{itemize}


\begin{figure}[h]
	\centering \includegraphics[width=0.95\columnwidth]{imgs/gesture-follower}
 \caption{The gesture follower appearance in its different phases.}
 \label{fig:gfgraph}
\end{figure}



%===============================
%:   Httpd server plugins
\sublevel{Httpd server plugin}
\label{Httpd}

INScore can embed Http server to expose real time screenshot image of a scene to the web. This feature is based on libmicrohttpd \footnote{\url{http://www.gnu.org/software/libmicrohttpd/}} and is available as a plugin that is included in the INScore distribution (version 1.11 or greater). The Url to get the image is the base url of the server.

%===============================
%:      Set messages
\subsublevel{Set Message}
\label{httpdsetmsg}

The http server object is created in a scene like other objects and served image of his scene.

\index{Httpd Server!set}

\begin{rail}
httpdserver: 'set' 'httpd' port
\end{rail}

\begin{itemize}
\item \OSC{port} http port used by the server.
\end{itemize}

\example \\
\sample{/ITL/scene/server set httpd 8000;}

\note{} \\
If the http port is already used, the server cannot start.

%===============================
%:      Specific messages
\subsublevel{Specific messages}
\label{httpdmsg}
The http server status can be delivered with a specific message.

\index{Httpd Server!status}

\begin{rail}
httpdmessage : 'get' status
\end{rail}

A string corresponding to the server status ("started" or "stopped") is return.

\example \\
\sample{/ITL/scene/server get status;}

%===============================
%:Appendix
\toplevel{Appendices}
\label{appendices}
\input{yacc.tex}

\input{tokens.tex}

\input{yaccexpr.tex}


%===============================
%:Changes list
\toplevel{ Changes list}
\label{changes}
\input{changelist.tex}


\printindex

\end{document}
